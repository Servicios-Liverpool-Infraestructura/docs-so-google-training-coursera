
<!DOCTYPE html>
<html lang='en'>
<head>
<title>AHYBRID075 Configuring GKE for Shared Control Plane Multi-Cluster Operation | Qwiklabs</title>
<script>
//<![CDATA[
window.gon={};gon.current_user={"firstname":"DANIEL","lastname":"ENRIQUE SANDOVAL SANCHEZ","fullname":"DANIEL ENRIQUE SANDOVAL SANCHEZ","company":"Coursera","email":"desandovals@liverpool.com.mx","origin":"googlecoursera-run, lti-coursera","subscriptions":0,"id":"40414ff5fc280f833d9acca966912f93","qlCreatedAt":"2020-11-17 20:45:59 UTC","optIn":null,"current_organization_id":null,"current_organization_role":null};gon.segment="j4Im8pqIko0Lxq4wVVZWMPMM0EroHUvb";gon.deployment="googlecoursera-run";gon.content={"type":"Lab","id":2077,"name":"AHYBRID075 Configuring GKE for Shared Control Plane Multi-Cluster Operation"};
//]]>
</script>
<script>
  dataLayer = [
    {user: gon.current_user},
    {content: gon.content}
  ];
</script>
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-TQR88QK");
</script>
<script>
  EVENT_SOURCE_BASE_URL = "https://googlecoursera-run.qwiklabs.com/nchan-sub?id=";
</script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/polyfills/webcomponents-loader-408088dc333247a761de5f2b2a4ba1cabd2bc36579f83ba92a559eb3682a9b77.js"></script>
<script src="https://cdn.qwiklabs.com/assets/vendor-45d462772c30000424907184f70c7157e95fb6227698d1671c5051818a6f60d8.js"></script>
<script src="https://cdn.qwiklabs.com/assets/application-6874b164d8346f46605fc772a6f7375a39626ffc9f6d168e23a3a8c40bb6fd28.js"></script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/hallofmirrors-b7ff781d00ceebdf75589f58475cea695bafd8d5cc1f3eb4baf6122ed4a4b736.js"></script>
<!--[if lt IE 9]>
<script src='http://html5shim.googlecode.com/svn/trunk/html5.js' type='text/javascript'></script>
<![endif]-->
<!--[endif]>  <![endif]-->
<script type='application/ld+json'>
{
  "@context": "http://schema.org",
  "@type": "WebSite",
  "url": "https://www.qwiklabs.com/",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.qwiklabs.com/catalog?keywords={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>
<script id='ze-snippet' src='https://static.zdassets.com/ekr/snippet.js?key=511e4158-0aec-4e3c-b2e6-4daa1769f51e'></script>


<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="TOHwsH0WyqLmJnV5J0tvMQVsK27R6Vgmf0wlinmLWd+N6jPfUt13cVBJtI3oYm0cbYYbs4D2haSGDfiAkbmiXg==" />
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0' name='viewport'>
<meta content='1rRsY0INj8RvwB5EF5pwdxt2A2P9aDgAlsICaJ0d5w0' name='google-site-verification'>
<meta content='#3681E4' property='msapplication-TileColor'>
<meta content='/favicon-144.png' property='msapplication-TileImage'>
<meta content='[{&quot;id&quot;:&quot;recaptcha_experiment&quot;,&quot;optimize_id&quot;:&quot;dpViOcLkT3qS4TvL2mRojA&quot;,&quot;title&quot;:&quot;No Recaptcha shown for trusted users&quot;,&quot;variant_index&quot;:0,&quot;variant&quot;:&quot;original&quot;}]' name='active-experiments'>
<meta content='{&quot;userId&quot;:3894861}' name='help-api-product-data'>
<meta content='Architecting Hybrid Infrastructure with Anthos: Configure a multi-service application across multiple clusters with a shared control-plane.' name='description'>
<meta content='Qwiklabs' name='author'>
<meta content='AHYBRID075 Configuring GKE for Shared Control Plane Multi-Cluster Operation | Qwiklabs' property='og:title'>
<meta content='website' property='og:type'>
<meta content='/favicon-144.png' property='og:image'>
<meta content='Qwiklabs' property='og:site_name'>
<meta content='Architecting Hybrid Infrastructure with Anthos: Configure a multi-service application across multiple clusters with a shared control-plane.' property='og:description'>
<meta content='/qwiklabs_logo_900x887.png' property='og:logo' size='900x887'>
<meta content='/qwiklabs_logo_994x187.png' property='og:logo' size='994x187'>


<link href='/favicon-32.png' rel='shortcut icon'>
<link color='#3681E4' href='/favicon-svg.svg' rel='mask-icon'>
<link href='/favicon-180.png' rel='apple-touch-icon-precomposed'>



<link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=Oswald:400|Roboto+Mono:400,700|Roboto:300,400,500,700|Google+Sans:300,400,500,700|Google+Sans+Display:400|Material+Icons|Google+Material+Icons" />


<link rel="stylesheet" media="all" href="https://cdn.qwiklabs.com/assets/application-cf67fd00dd904ecce1e24779d7504aefc7fbd5d00696246fa80212743a81bf07.css" />



</head>
<body class='lab-show l-full no-nav application-new focuses focuses-show lab-show l-full no-nav '>
<noscript>
<iframe height='0' src='https://www.googletagmanager.com/ns.html?id=GTM-TQR88QK' style='display:none;visibility:hidden;' width='0'></iframe>
</noscript>
<span class='hidden' id='flash-sibling-before'></span>

<div class='header-container'>
<div class='header'>
<ql-icon-button class='js-nav-toggle header__nav-panel-button l-mrm'>menu</ql-icon-button>
<div class='header__title'>
<ql-icon-button label="Back" href="https://www.coursera.org/" id="aa7dbe1ecc0ee4ad" target="_self">arrow_back</ql-icon-button><div class="mdl-tooltip" data-mdl-for="aa7dbe1ecc0ee4ad">Back</div>

<h1 class='headline-5'>
AHYBRID075 Configuring GKE for Shared Control Plane Multi-Cluster Operation
</h1>
</div>
<div class='header__actions'>
<ql-icon-button class='header__button--search js-header-search-bar-button'>search</ql-icon-button>
<ql-icon-button id='control-panel-target' style='display: none;'>
dashboard
</ql-icon-button>
<ql-menu for='control-panel-target' id='control-panel-menu'></ql-menu>

<ql-icon-button id='help-menu-button'>help</ql-icon-button>
<div class='mdl-tooltip js-tooltip' data-mdl-for='help-menu-button'>
Help
</div>
<ql-menu for='help-menu-button' id='help-menu'>
<ql-menu-item>
<ql-help context='lab' data-analytics-action='opened_help' data-analytics-label='lab' productdata='{&quot;userId&quot;:3894861}'>
Help Center
</ql-help>
</ql-menu-item>
<ql-menu-item>
<a target="_blank" class="ql-body-1" href="https://support.google.com/qwiklabs/contact/contact_us">Email support</a>
</ql-menu-item>
<ql-menu-item>
<a class='ql-body-1' onClick='ql.chat.open()'>Chat support</a>
</ql-menu-item>
</ql-menu>

<ql-icon-button id='language'>language</ql-icon-button>
<div class='mdl-menu mdl-menu__bottom-right mdl-js-menu elevation-3' for='language'>
<a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ar" href="/focuses/15531277?locale=ar&amp;parent=lti_session">العربية‬‎
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="de" href="/focuses/15531277?locale=de&amp;parent=lti_session">Deutsch
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="en" href="/focuses/15531277?locale=en&amp;parent=lti_session">English
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="es" href="/focuses/15531277?locale=es&amp;parent=lti_session">español (Latinoamérica)
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="fr" href="/focuses/15531277?locale=fr&amp;parent=lti_session">français
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="id" href="/focuses/15531277?locale=id&amp;parent=lti_session">bahasa Indonesia
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="it" href="/focuses/15531277?locale=it&amp;parent=lti_session">Italiano
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ja" href="/focuses/15531277?locale=ja&amp;parent=lti_session">日本語
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ko" href="/focuses/15531277?locale=ko&amp;parent=lti_session">한국어
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="pl" href="/focuses/15531277?locale=pl&amp;parent=lti_session">Polski
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="pt_BR" href="/focuses/15531277?locale=pt_BR&amp;parent=lti_session">português (Brasil)
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="pt_PT" href="/focuses/15531277?locale=pt_PT&amp;parent=lti_session">português (Portugal)
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ru" href="/focuses/15531277?locale=ru&amp;parent=lti_session">русский
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="tr" href="/focuses/15531277?locale=tr&amp;parent=lti_session">Türkçe
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="zh" href="/focuses/15531277?locale=zh&amp;parent=lti_session">简体中文
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="zh_TW" href="/focuses/15531277?locale=zh_TW&amp;parent=lti_session">繁體中文
</a></div>
<button class='icon-button' id='my_account'>
<ql-avatar></ql-avatar>
</button>
<ql-menu for='my_account' open>
<div class='my-account-menu'>
<ql-avatar class='l-mtl l-mbl' size='120'></ql-avatar>
<div class='my-account-menu__user-info l-mbl'>
<h4 class='ql-subhead-1'>DANIEL ENRIQUE SANDOVAL SANCHEZ</h4>
<p class='ql-body-2 text--light'>desandovals@liverpool.com.mx</p>
<p class='ql-body-2 text--light'>
</p>
<a class="text--green ql-subhead-2" href="/my_account/payments"><ql-chip positive>
0 Credits
</ql-chip>
</a></div>
<div class='buttons l-mbl'>
<a class="button button--hairline" id="settings" href="/my_account/profile">Settings</a>
</div>
<hr>
<ql-button data-analytics-action='clicked_sign_out' href='/users/sign_out' method='delete'>
Sign Out
</ql-button>
<div class='privacy l-mtl'>
<a class="ql-caption text--light" href="/privacy_policy">Privacy</a>
<span class='ql-caption text--light l-mls l-mrs'>&middot;</span>
<a class="ql-caption text--light" href="/terms_of_service">Terms</a>
</div>
</div>
</ql-menu>

</div>
</div>
<div class='header__search-bar js-header-search-bar'>
<form class="js-search-form-mobile" onsubmit="ql.searchFilter(); return false;" action="/searches/elasticsearch" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="pdivsHV2veFgCI0LqiNbIRfyU96KC8IW2wPXzkul2JNk02zfWr0AMtZnTP9lClkMfxhjA9sUH5QiQgrEo5cjEg==" />
<input type="text" name="keywords" id="keywords" placeholder="Search" maxlength="255" aria-label="catalog search bar" />
</form>

<ql-icon-button class='js-close-search-bar'>close</ql-icon-button>
</div>
</div>

<nav class='nav-bar'>
<a class="nav-bar__item js-navigation-button" href="/"><ql-icon class='nav-bar__item__icon'>
home
</ql-icon>
<span class='nav-bar__item__label'>
Home
</span>
</a>
<a class="nav-bar__item js-navigation-button" href="/catalog"><ql-icon class='nav-bar__item__icon'>
school
</ql-icon>
<span class='nav-bar__item__label'>
Catalog
</span>
</a>
<a class="nav-bar__item js-navigation-button" href="/my_learning"><ql-icon class='nav-bar__item__icon'>
event_note
</ql-icon>
<span class='nav-bar__item__label'>
My Learning
</span>
</a>
</nav>

<nav class='nav-panel js-nav-panel'>
<div class='nav-panel__logo'>
<div class='logo logo--blue'></div>
</div>
<a title="Home" tabindex="-1" class="nav-panel__item js-navigation-button" href="/"><ql-icon class='nav-panel__item__icon'>
home
</ql-icon>
<div class='nav-panel__item__label'>
Home
</div>
</a>
<a title="Catalog" tabindex="-1" class="nav-panel__item js-navigation-button" href="/catalog"><ql-icon class='nav-panel__item__icon'>
school
</ql-icon>
<div class='nav-panel__item__label'>
Catalog
</div>
</a>
<a title="My Learning" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_learning"><ql-icon class='nav-panel__item__icon'>
event_note
</ql-icon>
<div class='nav-panel__item__label'>
My Learning
</div>
</a>
<div class='nav-panel__spacer'></div>
<a title="Profile" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/profile"><ql-icon class='nav-panel__item__icon'>
account_circle
</ql-icon>
<div class='nav-panel__item__label'>
Profile
</div>
</a>
<a title="Credits &amp; Subscriptions" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/credits"><ql-icon class='nav-panel__item__icon'>
money
</ql-icon>
<div class='nav-panel__item__label'>
Credits &amp; Subscriptions
</div>
</a>
<a title="Security" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/security"><ql-icon class='nav-panel__item__icon'>
security
</ql-icon>
<div class='nav-panel__item__label'>
Security
</div>
</a>
<div class='nav-panel__spacer'></div>
<a class="nav-panel__item" tabindex="-1" href="#"><ql-help>
<div class='nav-panel__help-item'>
<ql-icon class='nav-panel__item__icon'>help</ql-icon>
<div class='nav-panel__item__label'>
Help
</div>
</div>
</ql-help>
</a><div class='nav-panel__small-links'>
<a tabindex="-1" href="/privacy_policy">Privacy</a>
<a tabindex="-1" href="/terms_of_service">Terms</a>
</div>
</nav>
<div class='nav-panel__overlay js-nav-toggle'></div>

<main class='js-main'>
<div class='l-main-wrapper' id='main-wrapper'>







<ql-drawer-container class='js-lab-state' data-analytics-payload='{&quot;label&quot;:&quot;AHYBRID075 Configuring GKE for Shared Control Plane Multi-Cluster Operation&quot;,&quot;lab_name&quot;:&quot;AHYBRID075 Configuring GKE for Shared Control Plane Multi-Cluster Operation&quot;,&quot;classroom_name&quot;:null,&quot;deployment&quot;:&quot;googlecoursera-run&quot;}' data-focus-id='15531277' data-lab-billing-limit='0.0' data-lab-duration='10800' data-parent='lti_session' data-recaptcha-enabled id='lab-container'>
<ql-drawer id='terminal-drawer' slot='drawer' style='width: calc(100% - 480px)'>
<iframe allow='clipboard-read' class='terminal' id='embedded-resource'></iframe>
</ql-drawer>
<ql-drawer-content class='js-lab-wrapper' id='lab-content' slot='drawer-content'>
<ql-drawer-container id='lab-content-container'>
<ql-drawer id='control-panel-drawer' open slot='drawer' width='320'>
<ql-lab-control-panel class='ql-lab-control-panel__max-height control-panel js-lab-control-panel' connectionFiles='[]' labControlButton='{&quot;disabled&quot;:false,&quot;pending&quot;:false,&quot;running&quot;:false}' labDetails='[]' labTimer='{&quot;ticking&quot;:false,&quot;secondsRemaining&quot;:10800}' studentResources='[]'>
<script src="https://www.recaptcha.net/recaptcha/api.js?render=6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr"   ></script>
        <script>
          // Define function so that we can call it again later if we need to reset it
          // This executes reCAPTCHA and then calls our callback.
          function executeRecaptchaForStartLab() {
            grecaptcha.ready(function() {
              grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}).then(function(token) {
                setInputWithRecaptchaResponseTokenForStartLab('g-recaptcha-response-data-start-lab', token)
              });
            });
          };
          // Invoke immediately
          executeRecaptchaForStartLab()

          // Async variant so you can await this function from another async function (no need for
          // an explicit callback function then!)
          // Returns a Promise that resolves with the response token.
          async function executeRecaptchaForStartLabAsync() {
            return new Promise((resolve, reject) => {
              grecaptcha.ready(async function() {
                resolve(await grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}))
              });
            })
          };

                    var setInputWithRecaptchaResponseTokenForStartLab = function(id, token) {
            var element = document.getElementById(id);
            element.value = token;
          }

        </script>
<input type="hidden" name="g-recaptcha-response-data[start_lab]" id="g-recaptcha-response-data-start-lab" data-sitekey="6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr" class="g-recaptcha g-recaptcha-response "/>

<div class='hidden' id='recaptcha-v2-start-lab' slot='recaptcha'>
<script src="https://www.recaptcha.net/recaptcha/api.js" async defer ></script>
<div data-sitekey="6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV" data-callback="recaptchaComplete" data-expired-callback="expireV2Token" class="g-recaptcha "></div>
          <noscript>
            <div>
              <div style="width: 302px; height: 422px; position: relative;">
                <div style="width: 302px; height: 422px; position: absolute;">
                  <iframe
                    src="https://www.recaptcha.net/recaptcha/api/fallback?k=6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV"
                    name="ReCAPTCHA"
                    style="width: 302px; height: 422px; border-style: none; border: 0; overflow: hidden;">
                  </iframe>
                </div>
              </div>
              <div style="width: 300px; height: 60px; border-style: none;
                bottom: 12px; left: 25px; margin: 0px; padding: 0px; right: 25px;
                background: #f9f9f9; border: 1px solid #c1c1c1; border-radius: 3px;">
                <textarea id="g-recaptcha-response" name="g-recaptcha-response"
                  class="g-recaptcha-response"
                  style="width: 250px; height: 40px; border: 1px solid #c1c1c1;
                  margin: 10px 25px; padding: 0px; resize: none;">
                </textarea>
              </div>
            </div>
          </noscript>

</div>
</ql-lab-control-panel>
</ql-drawer>
<ql-drawer-content id='lab-instructions' slot='drawer-content'>
<div class='alert alert--fake js-alert'>
<p class='alert__message js-alert-message'></p>
<a class='alert__close js-alert-close'>
<i class='fa fa-times'></i>
</a>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='js-lab-content lab-content__renderable-instructions'>
<div class='lab-preamble'>
<h1 class='lab-preamble__title'>
AHYBRID075 Configuring GKE for Shared Control Plane Multi-Cluster Operation
</h1>
<div class='lab-preamble__details subtitle-headline-1'>
<span>3 hours </span>
<span>Free</span>
<div class='lab__rating'>
<a href="/focuses/15531277/reviews?parent=lti_session"><div class='rateit' data-rateit-readonly='true' data-rateit-value='4.323'></div>

</a></div>
</div>
</div>

<div class='js-markdown-instructions markdown-lab-instructions' id='markdown-lab-instructions'>



<h2 id="step1">Overview</h2>
<p>This lab shows how to configure a single Istio service mesh with a
<strong>multicluster shared control plane</strong> architecture.</p>
<p>You will configure Istio with
<a href="https://github.com/GoogleCloudPlatform/microservices-demo" target="_blank">a multi-service application</a>
running across two Kubernetes Engine (GKE) clusters, located in two different
<a href="https://cloud.google.com/compute/docs/regions-zones/#identifying_a_region_or_zone" target="_blank">regions</a>,
in the same project.</p>
<p>In this configuration, a Kubernetes control plane, running a <em>remote</em>
configuration, connects to a single Istio control plane. Once one or more remote
Kubernetes clusters are connected to the Istio control plane, the remote Envoys
can then communicate, with the single control plane, and form a single service
mesh across multiple clusters.</p>
<p><img alt="Shared Control Plane Architecture" src="https://cdn.qwiklabs.com/MADqOBe%2F9fLdm8HxlgLhyniK%2BfIDbzvGRe3I1E4U0yo%3D"></p>
<h3>Objectives</h3>
<p>In this lab, you learn how to perform the following tasks:</p>
<ul>
<li>
<p>Set up the lab environment with 2 GKE clusters</p>
</li>
<li>
<p>Download lab files from a GitHub repo</p>
</li>
<li>
<p>Create GKE firewall rules to allow inter-cluster connections</p>
</li>
<li>
<p>Install the Istio control plane to cluster 1</p>
</li>
<li>
<p>Install the Istio remote on cluster 2</p>
</li>
<li>
<p>Connect cluster 2 to cluster 1</p>
</li>
<li>
<p>Deploy the Hipster Shop multi-service application</p>
</li>
<li>
<p>Verify the Hipster Shop deployment.</p>
</li>
<li>
<p>Use Hipster Shop services running across multiple clusters</p>
</li>
</ul>
<h2 id="step2">Task 0. Lab Setup</h2>
<p>In this task, you use Qwiklabs and perform initialization steps for your lab.</p>
<h3>Access Qwiklabs</h3>
<p>For each lab, you get a new GCP project and set of resources for a fixed time at no cost.</p>
<ol>
<li>
<p>Make sure you signed into Qwiklabs using an <strong>incognito window</strong>.</p>
</li>
<li>
<p>Note the lab's access time (for example, <img alt="img/time.png" src="https://cdn.qwiklabs.com/aZQJ4BT7uCmM9XR6BTXgTRP1Hfu1T7q6V%2BcnbdEsbpU%3D"> and make sure you can finish in that time block.</p>
</li>
</ol>
<aside> <p>
  There is no pause feature. You can restart if needed, but you have to start at the beginning.
  </p>

</aside>
<ol start="3">
<li>
<p>When ready, click <img alt="img/start_lab.png" src="https://cdn.qwiklabs.com/XE8x7uvQokyubNwnYKKc%2BvBBNrMlo5iNZiDDzQQ3Ddo%3D">.</p>
</li>
<li>
<p>Note your lab credentials. You will use them to sign in to Cloud Platform Console.
<img alt="img/open_google_console.png" src="https://cdn.qwiklabs.com/0d78dhX6IVMVWmixCPPSBbmi5O2GPokCXf1Ps1AkTgI%3D"></p>
</li>
<li>
<p>Click <strong>Open Google Console</strong>.</p>
</li>
<li>
<p>Click <strong>Use another account</strong> and copy/paste credentials for <strong>this</strong> lab into the prompts.</p>
</li>
</ol>
<aside class="warning"><p>
  If you use other credentials, you'll get errors or <strong>incur charges</strong>.
  </p>
</aside>
<ol start="7">
<li>Accept the terms and skip the recovery resource page.</li>
</ol>
<aside class="warning"><p>
  Do not click <strong>End Lab</strong> unless you are finished with the lab or want to restart it. This clears your work and removes the project.
  </p>
</aside>

<p>After you complete the initial sign-in steps, the project dashboard appears.</p>
<p><img alt="GCP Project Dashboard" src="https://cdn.qwiklabs.com/dxfeoOcn1ObyC0BYyoqqqSi4rO%2FeMdbWPFjoK6C0YYk%3D"></p>
<p>Click <strong>Select a project</strong>, highlight your <em>GCP Project ID</em>, and click
<strong>OPEN</strong> to select your project.</p>
<h3>Activate Google Cloud Shell</h3>
<p>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.
Google Cloud Shell provides command-line access to your GCP resources.</p>
<ol>
<li>
<p>In GCP console, on the top right toolbar, click the Open Cloud Shell button.</p>
<p><img alt="Cloud Shell icon" src="https://cdn.qwiklabs.com/vdY5e%2Fan9ZGXw5a%2FZMb1agpXhRGozsOadHURcR8thAQ%3D"></p>
</li>
<li>
<p>Click <strong>Continue</strong>.
<img alt="cloudshell_continue.png" src="https://cdn.qwiklabs.com/lr3PBRjWIrJ%2BMQnE8kCkOnRQQVgJnWSg4UWk16f0s%2FA%3D"></p>
</li>
</ol>
<p>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your <em>PROJECT_ID</em>. For example:</p>
<p><img alt="Cloud Shell Terminal" src="https://cdn.qwiklabs.com/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D"></p>
<p><strong>gcloud</strong> is the command-line tool for Google Cloud Platform. It comes pre-installed on Cloud Shell and supports tab-completion.</p>
<p>You can list the active account name with this command:</p>
<pre><code>gcloud auth list&#x000A;</code></pre>
<p>Output:</p>
<pre><code class="language-output prettyprint">Credentialed accounts:&#x000A; - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)&#x000A;</code></pre>
<p>Example output:</p>
<pre><code class="language-Output prettyprint">Credentialed accounts:&#x000A; - google1623327_student@qwiklabs.net&#x000A;</code></pre>
<p>You can list the project ID with this command:</p>
<pre><code>gcloud config list project&#x000A;</code></pre>
<p>Output:</p>
<pre><code class="language-output prettyprint">[core]&#x000A;project = &lt;project_ID&gt;&#x000A;</code></pre>
<p>Example output:</p>
<pre><code class="language-Output prettyprint">[core]&#x000A;project = qwiklabs-gcp-44776a13dea667a6&#x000A;</code></pre>
<ql-infobox>
  Full documentation of <strong>gcloud</strong> is available on
  <a href="https://cloud.google.com/sdk/gcloud" target="_blank">
    Google Cloud gcloud Overview
  </a>.
</ql-infobox>

<h2 id="step3">Task 1. Set up the lab environment with 2 GKE clusters</h2>
<p>In this lab you will use two Kubernetes clusters. The clusters have already
been deployed to your environment.</p>
<ul>
<li>
<p>A GKE cluster, named <code>cluster-1</code>, in the <code>us-east1</code> region.</p>
</li>
<li>
<p>A GKE cluster, named <code>cluster-2</code>, in the <code>us-central1</code> region.</p>
</li>
</ul>
<h3>Configure cluster access for kubectl</h3>
<ol start="0">
<li>
<p>In <strong>Cloud Shell</strong>, set up a working directory named <code>sharedcp-lab</code> with a
<code>bin</code> subdirectory. Place <code>bin</code> on the system PATH.</p>
<pre><code class="language-bash prettyprint">export PROJECT_ID=$(gcloud config get-value project)&#x000A;export LAB_DIR=$HOME/sharedcp-lab&#x000A;&#x000A;mkdir $LAB_DIR&#x000A;cd $LAB_DIR&#x000A;&#x000A;mkdir $PWD/bin&#x000A;export PATH=$PWD/bin:$PATH&#x000A;</code></pre>
</li>
<li>
<p>Wait for both clusters to show <strong>STATUS</strong> of <code>RUNNING</code>.</p>
<p>The prewarm script for this lab created two different GKE clusters:
cluster-1 and cluster-2.</p>
<pre><code class="language-bash prettyprint">watch -n 1 gcloud container clusters list&#x000A;</code></pre>
<p><code>Ctrl+c</code> to exit the <code>watch</code>.</p>
</li>
<li>
<p>Configure <code>kubectl</code> command line access for cluster-1.</p>
<pre><code class="language-bash prettyprint">export CLUSTER1_NAME=cluster-1&#x000A;export CLUSTER1_ZONE=us-east1-b&#x000A;&#x000A;gcloud container clusters get-credentials $CLUSTER1_NAME \&#x000A;    --zone $CLUSTER1_ZONE --project $PROJECT_ID&#x000A;</code></pre>
</li>
<li>
<p>Configure <code>kubectl</code> command line access for cluster-2.</p>
<pre><code class="language-bash prettyprint">export CLUSTER2_NAME=cluster-2&#x000A;export CLUSTER2_ZONE=us-central1-b&#x000A;&#x000A;gcloud container clusters get-credentials $CLUSTER2_NAME \&#x000A;    --zone $CLUSTER2_ZONE --project $PROJECT_ID&#x000A;</code></pre>
</li>
<li>
<p>Inspect the content of your <code>~/.kube/config</code> file.</p>
<p>This file was updated/populated by the previous command.</p>
<pre><code class="language-bash prettyprint">cat ~/.kube/config&#x000A;</code></pre>
<p>Notice there are two different sets of <code>cluster</code> configurations, each
with a key, and server address, and a name in the format
<code>gke_${PROJECT_ID}_${CLUSTER1_ZONE}_${CLUSTER1_NAME}</code></p>
</li>
<li>
<p>Set up short context names for <code>kubectx</code> using the two different names
from your <code>.kube/config</code> file.</p>
<pre><code class="language-bash prettyprint">kubectx cluster1=gke_${PROJECT_ID}_${CLUSTER1_ZONE}_${CLUSTER1_NAME}&#x000A;kubectx cluster2=gke_${PROJECT_ID}_${CLUSTER2_ZONE}_${CLUSTER2_NAME}&#x000A;</code></pre>
<p>This enables the <code>kubectx</code> command to be used to easily set <code>kubectl</code>
context using a command like <code>kubectx cluster1</code>.</p>
</li>
<li>
<p>List the <code>kubectx</code> available contexts.</p>
<pre><code class="language-bash prettyprint">kubectx&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>cluster1&#x000A;cluster2&#x000A;</code></pre>
</li>
</ol>
<h2 id="step4">Task 2. Download lab files from a GitHub repo</h2>
<p>Google engineers have created a set of Istio examples on GitHub for Google
Cloud. From <strong>Cloud Shell</strong>, clone the Istio examples repo into your working
directory. Then, change into the directory for the multi-cluster, shared
control-plane example.</p>
<pre><code class="language-bash prettyprint">git clone https://github.com/GoogleCloudPlatform/istio-samples.git&#x000A;</code></pre>
<pre><code class="language-bash prettyprint">cd istio-samples/multicluster-gke/single-control-plane&#x000A;</code></pre>
<h2 id="step5">Task 3. Create GKE firewall rules to allow inter-cluster connections</h2>
<p>The <code>scripts</code> subdirectory includes helper scripts. Using script number 3,
create a firewall rule so that pods from the two clusters can address each
other.</p>
<p>If you like, you can <code>edit</code> the script with the Cloud Shell editor to examine
it more carefully.</p>
<p>Now, run the script.</p>
<pre><code class="language-bash prettyprint">./scripts/3-firewall.sh&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>Creating firewall...done.&#x000A;NAME                          NETWORK  DIRECTION  PRIORITY  ALLOW                     DENY  DISABLED&#x000A;istio-multicluster-test-pods  default  INGRESS    900       tcp,udp,icmp,esp,ah,sctp        False&#x000A;</code></pre>
<p>This allows traffic from each cluster's CIDR block range into the other cluster.</p>
<p>If you don't do this, later on the <code>cartservice</code> running in the <em>remote</em>
cluster will have trouble communicating with services in cluster 1.</p>
<p><strong>Note:</strong> This is a very lenient firewall rule. This is not a recommended rule
for production environments.</p>
<h2 id="step6">Task 4. Install the Istio control plane</h2>
<ol>
<li>
<p>Get Istio.</p>
<p>Download the latest version</p>
<pre><code class="language-bash prettyprint">ISTIO_VERSION="${ISTIO_VERSION:-1.9.0}"&#x000A;curl -L https://git.io/getLatestIstio | ISTIO_VERSION=$ISTIO_VERSION sh -&#x000A;</code></pre>
<p>Add istioctl path</p>
<pre><code class="language-bash prettyprint">export PATH="$PATH:/home/$GOOGLE_CLOUD_PROJECT/istio-samples/multicluster-gke/single-control-plane/istio-1.9.0/bin"&#x000A;</code></pre>
<p>Change into the Istio installer folder</p>
<pre><code class="language-bash prettyprint">cd istio-$ISTIO_VERSION&#x000A;</code></pre>
</li>
<li>
<p>Configure trust between the two clusters, by creating a Root CA</p>
<p>Create a directory to hold certificates and keys</p>
<pre><code class="language-bash prettyprint">mkdir -p certs&#x000A;pushd certs&#x000A;</code></pre>
<p>Generate the root certificate and key</p>
<pre><code class="language-bash prettyprint">make -f ../tools/certs/Makefile.selfsigned.mk root-ca&#x000A;</code></pre>
<p>Generate an intermediate certificate and key for cluster1</p>
<pre><code class="language-bash prettyprint">make -f ../tools/certs/Makefile.selfsigned.mk cluster1-cacerts&#x000A;</code></pre>
<p>Generate an intermediate certificate and key for cluster2</p>
<pre><code class="language-bash prettyprint">make -f ../tools/certs/Makefile.selfsigned.mk cluster2-cacerts&#x000A;</code></pre>
<p>Change your default context to cluster1</p>
<pre><code class="language-bash prettyprint">kubectx cluster1&#x000A;</code></pre>
<p>In cluster1, create a secret cacerts including all the input files ca-cert.pem, ca-key.pem, root-cert.pem and cert-chain.pem</p>
<pre><code class="language-bash prettyprint">kubectl create namespace istio-system&#x000A;kubectl create secret generic cacerts -n istio-system \&#x000A;    --from-file=cluster1/ca-cert.pem \&#x000A;    --from-file=cluster1/ca-key.pem \&#x000A;    --from-file=cluster1/root-cert.pem \&#x000A;    --from-file=cluster1/cert-chain.pem&#x000A;</code></pre>
<p>Change your default context to cluster2</p>
<pre><code class="language-bash prettyprint">kubectx cluster2&#x000A;</code></pre>
<p>In cluster2, create a secret cacerts including all the input files ca-cert.pem, ca-key.pem, root-cert.pem and cert-chain.pem</p>
<pre><code class="language-bash prettyprint">kubectl create namespace istio-system&#x000A;kubectl create secret generic cacerts -n istio-system \&#x000A;    --from-file=cluster2/ca-cert.pem \&#x000A;    --from-file=cluster2/ca-key.pem \&#x000A;    --from-file=cluster2/root-cert.pem \&#x000A;    --from-file=cluster2/cert-chain.pem&#x000A;</code></pre>
<p>Return to the top-level directory of the Istio installation</p>
<pre><code class="language-bash prettyprint">popd&#x000A;</code></pre>
</li>
<li>
<p>Create the IstioOperator for the primary cluster</p>
<pre><code class="language-bash prettyprint">cat &lt;&lt;EOF &gt; cluster1.yaml&#x000A;apiVersion: install.istio.io/v1alpha1&#x000A;kind: IstioOperator&#x000A;spec:&#x000A;  values:&#x000A;    global:&#x000A;      meshID: mesh1&#x000A;      multiCluster:&#x000A;        clusterName: cluster1&#x000A;      network: default&#x000A;EOF&#x000A;</code></pre>
<pre><code class="language-bash prettyprint">istioctl install --context=cluster1 -f cluster1.yaml&#x000A;</code></pre>
</li>
</ol>
<h2 id="step7">Task 5. Install the Istio remote on cluster 2</h2>
<ol>
<li>
<p>Install a gateway in cluster1 that is dedicated to east-west traffic.</p>
<p>By default, this gateway will be public on the Internet. Production systems may require additional access restrictions (e.g. via firewall rules) to prevent external attacks.</p>
<pre><code class="language-bash prettyprint">samples/multicluster/gen-eastwest-gateway.sh \&#x000A;    --mesh mesh1 --cluster cluster1 --network default | \&#x000A;    istioctl --context=cluster1 install -y -f -&#x000A;</code></pre>
<p>Wait for the east-west gateway to be assigned an external IP address. Rerun command as needed until supplied</p>
<pre><code class="language-bash prettyprint">kubectl --context=cluster1 get svc istio-eastwestgateway -n istio-system&#x000A;</code></pre>
<p>Before we can install on cluster2, we need to first expose the control plane in cluster1 so that services in cluster2 will be able to access service discovery</p>
<pre><code class="language-bash prettyprint">kubectl apply --context=cluster1 -f \&#x000A;    samples/multicluster/expose-istiod.yaml&#x000A;</code></pre>
</li>
<li>
<p>Allow API Server access between the two clusters</p>
<p>Generate a remote secret and apply it to cluster1 to enable API Server access to cluster2</p>
<pre><code class="language-bash prettyprint">istioctl x create-remote-secret \&#x000A;    --context=cluster2 \&#x000A;    --name=cluster2 | \&#x000A;    kubectl apply -f - --context=cluster1&#x000A;</code></pre>
<p>Save the address of cluster1’s east-west gateway</p>
<pre><code class="language-bash prettyprint">export DISCOVERY_ADDRESS=$(kubectl \&#x000A;    --context=cluster1 \&#x000A;    -n istio-system get svc istio-eastwestgateway \&#x000A;    -o jsonpath='{.status.loadBalancer.ingress[0].ip}')&#x000A;echo $DISCOVERY_ADDRESS&#x000A;</code></pre>
<p>Now create a remote configuration for cluster2</p>
<pre><code class="language-bash prettyprint">cat &lt;&lt;EOF &gt; cluster2.yaml&#x000A;apiVersion: install.istio.io/v1alpha1&#x000A;kind: IstioOperator&#x000A;spec:&#x000A;  profile: remote&#x000A;  values:&#x000A;    global:&#x000A;      meshID: mesh1&#x000A;      multiCluster:&#x000A;        clusterName: cluster2&#x000A;      network: default&#x000A;      remotePilotAddress: ${DISCOVERY_ADDRESS}&#x000A;EOF&#x000A;</code></pre>
<p>Apply the configuration to cluster2</p>
<pre><code class="language-bash prettyprint">istioctl install --context=cluster2 -f cluster2.yaml&#x000A;</code></pre>
</li>
</ol>
<h2 id="step8">Task 6. Deploy the Hipster Shop multi-service application</h2>
<p>In this task you use a script to deploy the 'Hipster Shop' sample application
across both cluster 1 and cluster 2.</p>
<p>The microservices in the application have been distributed so that some run
<em>centrally</em>, with the Istio control plane, in cluster 1. The rest run on the
<em>remote</em> Istio cluster, cluster 2.</p>
<p>The result will look something like:</p>
<p><img alt="Shared Control Plane Architecture" src="https://cdn.qwiklabs.com/MADqOBe%2F9fLdm8HxlgLhyniK%2BfIDbzvGRe3I1E4U0yo%3D"></p>
<ql-infobox>
<strong>Note:</strong>The default Hipster Shop manifest is used to deploy all
services and deployments to both of the clusters. For each cluster, you'll
remove the deployments that have been assigned to the other cluster.
Both clusters are required to run Kubernets Services for all of the
Hipster Shop microservices, to all cross-cluster DNS to work.
</ql-infobox>
<ol>
<li>
<p>Clone the Google microservices-demo</p>
<pre><code class="language-bash prettyprint">cd ~/sharedcp-lab/istio-samples/multicluster-gke/single-control-plane&#x000A;git clone https://github.com/GoogleCloudPlatform/microservices-demo&#x000A;cd microservices-demo&#x000A;</code></pre>
</li>
<li>
<p>Switch to <code>cluster1</code> context.</p>
<pre><code class="language-bash prettyprint">kubectx cluster1&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>Switched to context "cluster1".&#x000A;</code></pre>
</li>
<li>
<p>Deploy all the Hipster Shop services to cluster 1:</p>
<pre><code class="language-bash prettyprint">kubectl label namespace default istio-injection=enabled&#x000A;kubectl apply -f ./release&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>deployment.apps/emailservice created&#x000A;service/emailservice created&#x000A;deployment.apps/checkoutservice created&#x000A;service/checkoutservice created&#x000A;deployment.apps/recommendationservice created&#x000A;service/recommendationservice created&#x000A;deployment.apps/frontend created&#x000A;service/frontend created&#x000A;service/frontend-external created&#x000A;deployment.apps/paymentservice created&#x000A;service/paymentservice created&#x000A;deployment.apps/productcatalogservice created&#x000A;service/productcatalogservice created&#x000A;deployment.apps/cartservice created&#x000A;service/cartservice created&#x000A;deployment.apps/loadgenerator created&#x000A;deployment.apps/currencyservice created&#x000A;service/currencyservice created&#x000A;deployment.apps/shippingservice created&#x000A;service/shippingservice created&#x000A;deployment.apps/redis-cart created&#x000A;service/redis-cart created&#x000A;deployment.apps/adservice created&#x000A;service/adservice created&#x000A;</code></pre>
</li>
<li>
<p>Remove the deployments assigned to cluster 2:</p>
<pre><code class="language-bash prettyprint">services2=("loadgenerator" "cartservice" "recommendationservice" "redis-cart")&#x000A;for s in "${services2[@]}"; do kubectl delete deployment $s; done;&#x000A;</code></pre>
</li>
<li>
<p>Switch to <code>cluster2</code> context.</p>
<pre><code class="language-bash prettyprint">kubectx cluster2&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>Switched to context "cluster2".&#x000A;</code></pre>
</li>
<li>
<p>Deploy all the Hipster Shop services to cluster 2:</p>
<pre><code class="language-bash prettyprint">kubectl label namespace default istio-injection=enabled&#x000A;kubectl apply -f ./release&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>deployment.apps/emailservice created&#x000A;service/emailservice created&#x000A;deployment.apps/checkoutservice created&#x000A;service/checkoutservice created&#x000A;deployment.apps/recommendationservice created&#x000A;service/recommendationservice created&#x000A;deployment.apps/frontend created&#x000A;service/frontend created&#x000A;service/frontend-external created&#x000A;deployment.apps/paymentservice created&#x000A;service/paymentservice created&#x000A;deployment.apps/productcatalogservice created&#x000A;service/productcatalogservice created&#x000A;deployment.apps/cartservice created&#x000A;service/cartservice created&#x000A;deployment.apps/loadgenerator created&#x000A;deployment.apps/currencyservice created&#x000A;service/currencyservice created&#x000A;deployment.apps/shippingservice created&#x000A;service/shippingservice created&#x000A;deployment.apps/redis-cart created&#x000A;service/redis-cart created&#x000A;deployment.apps/adservice created&#x000A;service/adservice created&#x000A;</code></pre>
</li>
<li>
<p>Remove the deployments assigned to cluster 1:</p>
<pre><code class="language-bash prettyprint">services1=("emailservice" "paymentservice" "shippingservice" "adservice" "checkoutservice" "currencyservice" "frontend" "productcatalogservice")&#x000A;for s in "${services1[@]}"; do kubectl delete deployment $s; done;&#x000A;&#x000A;</code></pre>
</li>
</ol>
<h2 id="step9">Task 7. Verify the Hipster Shop deployment</h2>
<p>You can verify that the deployment was successful in multiple ways.</p>
<h3>Review running pods on both clusters</h3>
<ol>
<li>
<p>Switch to <code>cluster1</code> context.</p>
<pre><code class="language-bash prettyprint">kubectx cluster1&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>Switched to context "cluster1".&#x000A;</code></pre>
</li>
<li>
<p>Check cluster 1 to ensure all pods are <strong>RUNNING</strong> and <strong>READY</strong>.</p>
<p>You may need to retry the command if some of the pods are still starting.</p>
<pre><code class="language-bash prettyprint">kubectl get pods&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>NAME                                    READY   STATUS&#x000A;adservice-56d9c5dcf7-q5cbh              2/2     Running&#x000A;checkoutservice-6c6897bcf9-2zbr6        2/2     Running&#x000A;currencyservice-7c75f54c7-fgg5f         2/2     Running&#x000A;emailservice-5b75c9dc45-8r74m           2/2     Running&#x000A;frontend-675b87697c-j87c6               2/2     Running&#x000A;paymentservice-cddb8f799-rgxsx          2/2     Running&#x000A;productcatalogservice-f59fbf555-kdppx   2/2     Running&#x000A;shippingservice-7b8dd7b7d7-qwh9c        2/2     Running&#x000A;</code></pre>
<p>You should only see 8 running microservices.</p>
</li>
<li>
<p>Switch to <code>cluster2</code> context.</p>
<pre><code class="language-bash prettyprint">kubectx cluster2&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>Switched to context "cluster2".&#x000A;</code></pre>
</li>
<li>
<p>Check pods on cluster 2 to ensure all pods are <strong>RUNNING</strong> and <strong>READY</strong>.</p>
<pre><code class="language-bash prettyprint">kubectl get pods&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>NAME                                     READY   STATUS&#x000A;cartservice-56db9fc8cd-6mx4s             2/2     Running&#x000A;loadgenerator-c9c947b95-88k5d            2/2     Running&#x000A;recommendationservice-558d8bb7c7-gdd2g   2/2     Running&#x000A;redis-cart-65bf66b8fd-7rr2w              2/2     Running&#x000A;</code></pre>
<p>You should only see 3 running microservices, and the related <code>redis-cart</code>.</p>
</li>
</ol>
<h3>Check the Envoy proxies running on both clusters</h3>
<ol>
<li>
<p>Switch to <code>cluster1</code> context.</p>
<pre><code class="language-bash prettyprint">kubectx cluster1&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>Switched to context "cluster1".&#x000A;</code></pre>
</li>
<li>
<p>Check the proxies, from cluster 1, where the control plane runs.</p>
<pre><code class="language-bash prettyprint">istioctl proxy-status&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>NAME                                                   CDS&#x000A;adservice-56d9c5dcf7-q5cbh.default                     SYNCED ...&#x000A;cartservice-56db9fc8cd-6mx4s.default                   SYNCED ...&#x000A;checkoutservice-6c6897bcf9-2zbr6.default               SYNCED ...&#x000A;currencyservice-7c75f54c7-fgg5f.default                SYNCED ...&#x000A;emailservice-5b75c9dc45-8r74m.default                  SYNCED ...&#x000A;frontend-675b87697c-j87c6.default                      SYNCED ...&#x000A;istio-ingressgateway-68c94fff4c-hbc22.istio-system     SYNCED ...&#x000A;loadgenerator-c9c947b95-88k5d.default                  SYNCED ...&#x000A;paymentservice-cddb8f799-rgxsx.default                 SYNCED ...&#x000A;productcatalogservice-f59fbf555-kdppx.default          SYNCED ...&#x000A;recommendationservice-558d8bb7c7-gdd2g.default         SYNCED ...&#x000A;redis-cart-65bf66b8fd-7rr2w.default                    SYNCED ...&#x000A;shippingservice-7b8dd7b7d7-qwh9c.default               SYNCED ...&#x000A;</code></pre>
<p><strong>Note:</strong> you can see proxy status for all services, including the 3 that
run in cluster 2, e.g. <code>cartservice</code>. This means that the Istio control
plane, in <code>cluster-1</code>, can successfully configure Envoy proxies running on
the remote GKE <code>cluster-2</code>.</p>
<p>FYI, DS stands for "Discovery Service" and there are several types:</p>
<p>|CDS|Cluster|Backend clusters the service has|
|LDS|Listener|Port filter|
|EDS|Endpoint|The endpoint itself|
|RDS|Route|What cluster gets this HTTP header|</p>
</li>
</ol>
<h2 id="step10">Task 8. Use Hipster Shop services running across multiple clusters</h2>
<p>In this task, you open Hipster and explore the application.</p>
<ol>
<li>
<p>Switch to <code>cluster1</code> context.</p>
<pre><code class="language-bash prettyprint">kubectx cluster1&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>Switched to context "cluster1".&#x000A;</code></pre>
</li>
<li>
<p>Get the Istio IngressGateway's <strong>EXTERNAL-IP</strong>.</p>
<pre><code class="language-bash prettyprint">kubectl get svc istio-ingressgateway -n istio-system&#x000A;</code></pre>
<p><strong>Output (do not copy)</strong></p>
<pre><code>NAME                   TYPE           CLUSTER-IP    EXTERNAL-IP      PORT(S)&#x000A;istio-ingressgateway   LoadBalancer   10.12.15.92   104.196.15.185   ...&#x000A;</code></pre>
<p>In this example, the <strong>EXTERNAL-IP</strong> is <code>104.196.15.185</code>.</p>
</li>
<li>
<p>Copy and paste the Istio ingress gateway IP address to a web browser tab.</p>
<p>You should see the Hipster Shop home page, at <code>http://[EXTERNAL_IP]</code>.</p>
<p><img alt="Hipster Shop UI" src="https://cdn.qwiklabs.com/WWPQw8n3Kr7QrrUrca%2BiDBAZq7pe5zWCX10JGmgS%2BJE%3D"></p>
</li>
<li>
<p>Verify that the Hipster app is fully functional.</p>
<p>Remember, it's running across 2 Kubernetes clusters in 2 environments.</p>
<p>Browse products, add products to your cart, checkout, etc.</p>
</li>
</ol>
<h2 id="step11">Review</h2>
<p>In this lab, you set up an environment with 2 GKE clusters, in different
regions, within a single service mesh, and a shared control plane. You then
ran a multi-service application with services spread across both clusters.</p>
<h3>Next Steps</h3>
<ul>
<li>Read more about
<a href="https://istio.io/v1.4/docs/setup/install/multicluster/shared-vpn/" target="_blank">shared control plane (single-network)</a>
in the Istio docs.</li>
<li>Read more about
<a href="https://istio.io/v1.4/docs/setup/install/multicluster/shared-gateways/" target="_blank">shared control plane (multi-network)</a>
in the Istio docs.</li>
<li>To explore <em>multicluster multiple control plane</em>, try
<a href="https://github.com/GoogleCloudPlatform/istio-samples/tree/master/multicluster-gke/dual-control-plane" target="_blank">this tutorial</a> which runs 2 clusters
on GKE, in 2 different projects, with 2 different VPC networks.</li>
</ul>
<h2 id="step12">End your lab</h2>
<p>When you have completed your lab, click <strong>End Lab</strong>. Qwiklabs removes the resources you’ve used and cleans the account for you.</p>
<p>You will be given an opportunity to rate the lab experience. Select the applicable number of stars, type a comment, and then click <strong>Submit</strong>.</p>
<p>The number of stars indicates the following:</p>
<ul>
<li>1 star = Very dissatisfied</li>
<li>2 stars = Dissatisfied</li>
<li>3 stars = Neutral</li>
<li>4 stars = Satisfied</li>
<li>5 stars = Very satisfied</li>
</ul>
<p>You can close the dialog box if you don't want to provide feedback.</p>
<p>For feedback, suggestions, or corrections, please use the <strong>Support</strong> tab.</p>

<p>Copyright 2021 Google LLC All rights reserved. Google and the Google logo are trademarks of Google LLC. All other company and product names may be trademarks of the respective companies with which they are associated.</p>



</div>
</div>


<div class='hidden js-end-lab-button-container lab-content__end-lab-button'>
<ql-lab-control-button class='js-end-lab-button' running></ql-lab-control-button>
</div>
<!-- / TODO: Move recommendations into the end lab modal -->
</ql-drawer-content>
<ql-drawer end id='outline-drawer' open slot='drawer' width='320'>
<div class='js-lab-content-outline lab-content__outline'>
<a href='#step1'>Overview</a><a href='#step2'>Task 0. Lab Setup</a><a href='#step3'>Task 1. Set up the lab environment with 2 GKE clusters</a><a href='#step4'>Task 2. Download lab files from a GitHub repo</a><a href='#step5'>Task 3. Create GKE firewall rules to allow inter-cluster connections</a><a href='#step6'>Task 4. Install the Istio control plane</a><a href='#step7'>Task 5. Install the Istio remote on cluster 2</a><a href='#step8'>Task 6. Deploy the Hipster Shop multi-service application</a><a href='#step9'>Task 7. Verify the Hipster Shop deployment</a><a href='#step10'>Task 8. Use Hipster Shop services running across multiple clusters</a><a href='#step11'>Review</a><a href='#step12'>End your lab</a>
</div>
</ql-drawer>
</ql-drawer-container>
</ql-drawer-content>
</ql-drawer-container>
<div class='lab-introduction js-lab-introduction is-hidden'>
<div class='lab-introduction__inner'>
<h1 class='headline-1'>Welcome to Your First Lab!</h1>
<ql-icon-button class='js-skip-button'>close</ql-icon-button>
<div class='lab-introduction__video'>
<iframe allow='autoplay; encrypted-media' allowfullscreen frameborder='0' id='lab-introduction' src='https://www.youtube.com/embed/yF7EDXKTmoQ?enablejsapi=1&amp;rel=0&amp;showinfo=0'></iframe>
</div>
<a class='js-skip-button button button--outline'>Skip this video</a>
</div>
</div>



</div>
</main>


<div class='modal fade' id='lab-details-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<div class='modal-body'>
<p class='l-mbm'>
Architecting Hybrid Infrastructure with Anthos: Configure a multi-service application across multiple clusters with a shared control-plane.
</p>
<p class='small-label l-mbs'>
<strong>
Duration:
</strong>
1m setup
&middot;
180m access
&middot;
120m completion
</p>
<p class='small-label l-mbs'>
<span><strong>Levels: </strong>intermediate</span>
</p>
<p class='small-label'>
<strong>
Permalink:
</strong>
<a href="https://googlecoursera.qwiklabs.com/catalog_lab/2077">https://googlecoursera.qwiklabs.com/catalog_lab/2077</a>
</p>
</div>
<div class='modal-actions'>
<a class='button button--text' data-dismiss='modal'>
Got It
</a>
</div>


</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='modal fade' id='lab-review-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<form class="simple_form js-lab-review-form" id="new_lab_review" action="/lab_reviews" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><div class='modal-body'>
<p class='label'>
How satisfied are you with this lab?*
</p>
<div class='rateit js-rateit' data-rateit-max='5' data-rateit-min='0' data-rateit-resetable='false' data-rateit-step='1' data-rateit-value='0'></div>
<div class='l-mtm'>

<div class="control-group hidden lab_review_user_id"><div class="controls"><input class="hidden" type="hidden" value="3894861" name="lab_review[user_id]" id="lab_review_user_id" /></div></div>
<div class="control-group hidden lab_review_classroom_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[classroom_id]" id="lab_review_classroom_id" /></div></div>
<div class="control-group hidden lab_review_lab_id"><div class="controls"><input class="hidden" type="hidden" value="2077" name="lab_review[lab_id]" id="lab_review_lab_id" /></div></div>
<div class="control-group hidden lab_review_focus_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[focus_id]" id="lab_review_focus_id" /></div></div>
<div class="control-group hidden lab_review_rating"><div class="controls"><input class="hidden js-rating-input" type="hidden" name="lab_review[rating]" id="lab_review_rating" /></div></div>
<div class="control-group text optional lab_review_comment"><label class="text optional control-label" for="lab_review_comment">Comment</label><div class="controls"><textarea class="text optional" name="lab_review[comment]" id="lab_review_comment">
</textarea></div></div>
</div>
</div>
<div class='modal-actions'>
<a class='button button--text' data-dismiss='modal'>
Cancel
</a>
<input type="submit" name="commit" value="Submit" disabled="disabled" id="submit" data-disabled="false" class="button" data-disable-with="Submit" />
</div>
</form>

</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>


<script>
  $( function() {
    ql.initMaterialInputs();
    initChosen();
    initSearch();
    initTabs();
    ql.list.init();
    ql.favoriting.init();
    ql.header.myAccount.init();
    initTooltips();
    ql.autocomplete.init();
    ql.modals.init();
    ql.toggleButtons.init();
    ql.analytics.init();
    ql.labControlPanel.addRecaptchaErrorHandler();
  initLabContent();
  ql.labOutline.links.init();
  initLabReviewModal();
  ql.labAssessment.init();
  ql.labIntroduction.init( true );
  ql.labData.init();
  initLabTranslations( {"are_you_sure":"All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?\n","in_progress":"*In Progress*","ending":"*Ending*","starting":"*Starting, please wait*","end_concurrent_labs":"Sorry, you can only run one lab at a time. To start this lab, please confirm that you want all of your existing labs to end.\n","copied":"Copied","no_resource":"Error retrieving resource.","no_support":"No Support","mac_press":"Press ⌘-C to copy","thanks_review":"Thanks for reviewing this lab.","windows_press":"Press Ctrl-C to copy","days":"days"} );
  ql.labRun.init();
  ql.chat.init();
  ql.initHeader();
  ql.navigation.init();
  ql.navPanel.init();
  ql.navigation.init();
  
  });
</script>

</body>
</html>

