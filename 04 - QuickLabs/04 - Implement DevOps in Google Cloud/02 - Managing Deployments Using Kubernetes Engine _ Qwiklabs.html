
<!DOCTYPE html>
<html lang='en'>
<head>
<title>Managing Deployments Using Kubernetes Engine | Qwiklabs</title>
<script>
//<![CDATA[
window.gon={};gon.current_user={"firstname":"DANIEL","lastname":"ENRIQUE SANDOVAL SANCHEZ","fullname":"DANIEL ENRIQUE SANDOVAL SANCHEZ","company":"Coursera","email":"desandovals@liverpool.com.mx","origin":"googlecoursera-run, lti-coursera","subscriptions":0,"id":"40414ff5fc280f833d9acca966912f93","qlCreatedAt":"2020-11-17 20:45:59 UTC","optIn":null,"current_organization_id":null,"current_organization_role":null};gon.segment="j4Im8pqIko0Lxq4wVVZWMPMM0EroHUvb";gon.deployment="run";gon.content={"type":"Lab","id":572,"name":"Managing Deployments Using Kubernetes Engine"};
//]]>
</script>
<script>
  dataLayer = [
    {user: gon.current_user},
    {content: gon.content}
  ];
</script>
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-TQR88QK");
</script>
<script>
  EVENT_SOURCE_BASE_URL = "https://run.qwiklabs.com/nchan-sub?id=";
</script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/polyfills/webcomponents-loader-408088dc333247a761de5f2b2a4ba1cabd2bc36579f83ba92a559eb3682a9b77.js"></script>
<script src="https://cdn.qwiklabs.com/assets/vendor-45d462772c30000424907184f70c7157e95fb6227698d1671c5051818a6f60d8.js"></script>
<script src="https://cdn.qwiklabs.com/assets/application-034d6698d9e8e4069d310e418a7827442046e71025a0e336e0896055be8a1153.js"></script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/hallofmirrors-b1177b2da0d0a4d1b239b0364e70f5a598873a2b8fb44c288c9428709123506c.js"></script>
<!--[if lt IE 9]>
<script src='http://html5shim.googlecode.com/svn/trunk/html5.js' type='text/javascript'></script>
<![endif]-->
<!--[endif]>  <![endif]-->
<script type='application/ld+json'>
{
  "@context": "http://schema.org",
  "@type": "WebSite",
  "url": "https://www.qwiklabs.com/",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.qwiklabs.com/catalog?keywords={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>


<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="6gUPtqwKUYq1P9lYf7p/3Sa7PMb/ydnUR2evMyJV4UB6ixiHjOFH11f3tlfd0aFOpdiNwIRrB91fgrDbI/mxdA==" />
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0' name='viewport'>
<meta content='1rRsY0INj8RvwB5EF5pwdxt2A2P9aDgAlsICaJ0d5w0' name='google-site-verification'>
<meta content='#3681E4' property='msapplication-TileColor'>
<meta content='/favicon-144.png' property='msapplication-TileImage'>
<meta content='[{&quot;id&quot;:&quot;recaptcha_experiment&quot;,&quot;optimize_id&quot;:&quot;dpViOcLkT3qS4TvL2mRojA&quot;,&quot;title&quot;:&quot;No Recaptcha shown for trusted users&quot;,&quot;variant_index&quot;:0,&quot;variant&quot;:&quot;original&quot;}]' name='active-experiments'>
<meta content='{&quot;userId&quot;:3894861}' name='help-api-product-data'>
<meta content='Dev Ops best practices make use of multiple deployments to manage application deployment scenarios. This lab provides practice in scaling and managing containers to accomplish common scenarios where multiple heterogeneous deployments are used.' name='description'>
<meta content='Qwiklabs' name='author'>
<meta content='Managing Deployments Using Kubernetes Engine | Qwiklabs' property='og:title'>
<meta content='website' property='og:type'>
<meta content='/favicon-144.png' property='og:image'>
<meta content='Qwiklabs' property='og:site_name'>
<meta content='Dev Ops best practices make use of multiple deployments to manage application deployment scenarios. This lab provides practice in scaling and managing containers to accomplish common scenarios where multiple heterogeneous deployments are used.' property='og:description'>
<meta content='/qwiklabs_logo_900x887.png' property='og:logo' size='900x887'>
<meta content='/qwiklabs_logo_994x187.png' property='og:logo' size='994x187'>


<link href='/favicon-32.png' rel='shortcut icon'>
<link color='#3681E4' href='/favicon-svg.svg' rel='mask-icon'>
<link href='/favicon-180.png' rel='apple-touch-icon-precomposed'>



<link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=Oswald:400|Roboto+Mono:400,700|Roboto:300,400,500,700|Google+Sans:300,400,500,700|Google+Sans+Display:400|Material+Icons|Google+Material+Icons" />


<link rel="stylesheet" media="all" href="https://cdn.qwiklabs.com/assets/application-3b0f6c441394eebd52ff10f04fb2923fdb7b1b4fec780e7fa8ef67f5dd2ef411.css" />



</head>
<body class='lab-show l-full no-nav application-new focuses focuses-show lab-show l-full no-nav '>
<noscript>
<iframe height='0' src='https://www.googletagmanager.com/ns.html?id=GTM-TQR88QK' style='display:none;visibility:hidden;' width='0'></iframe>
</noscript>
<span class='hidden' id='flash-sibling-before'></span>

<div class='header-container light-theme'>
<div class='header'>
<ql-icon-button class='js-nav-toggle header__nav-panel-button l-mrm'>menu</ql-icon-button>
<div class='header__title'>
<ql-icon-button label="Back" href="https://www.qwiklabs.com/quests/141" id="84c90b5853a813e8" target="_self">arrow_back</ql-icon-button><div class="mdl-tooltip" data-mdl-for="84c90b5853a813e8">Back</div>

<h1 class='headline-5'>
Managing Deployments Using Kubernetes Engine
</h1>
</div>
<div class='header__actions'>
<ql-icon-button class='header__button--search js-header-search-bar-button'>search</ql-icon-button>
<ql-icon-button id='share_572'>share</ql-icon-button>
<ql-menu for='share_572'>
<ql-menu-item>
<a data-analytics-action="Shared to LinkedIn." data-analytics-category="Lab" data-analytics-label="Managing Deployments Using Kubernetes Engine" target="_blank" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.qwiklabs.com%2Fcatalog_lab%2F572%3Futm_medium%3Dsocial%26utm_source%3Dlinkedin%26utm_campaign%3Dql-social-share"><ql-icon class='l-mrs'>post_linkedin</ql-icon>
LinkedIn
</a>
</ql-menu-item>
<ql-menu-item>
<a data-analytics-action="Shared to Twitter." data-analytics-category="Lab" data-analytics-label="Managing Deployments Using Kubernetes Engine" target="_blank" href="https://twitter.com/intent/tweet?text=Learn%20cloud%20tech%20through%20hands-on%20training%20on%20%23Qwiklabs%21&amp;url=https%3A%2F%2Fwww.qwiklabs.com%2Fcatalog_lab%2F572%3Futm_medium%3Dsocial%26utm_source%3Dtwitter%26utm_campaign%3Dql-social-share&amp;hashtags="><ql-icon class='l-mrs'>post_twitter</ql-icon>
Twitter
</a>
</ql-menu-item>
<ql-menu-item>
<a data-analytics-action="Shared to Facebook." data-analytics-category="Lab" data-analytics-label="Managing Deployments Using Kubernetes Engine" target="_blank" href="https://facebook.com/sharer.php?display=popup&amp;u=https%3A%2F%2Fwww.qwiklabs.com%2Fcatalog_lab%2F572%3Futm_medium%3Dsocial%26utm_source%3Dfacebook%26utm_campaign%3Dql-social-share"><ql-icon class='l-mrs'>post_facebook</ql-icon>
Facebook
</a>
</ql-menu-item>
<ql-menu-item>
<ql-copyable-input label='Share Link' value='https://www.qwiklabs.com/catalog_lab/572'></ql-copyable-input>
</ql-menu-item>
</ql-menu>

<a class="icon-button js-favorite-button favorite-button" id="CatalogItem-639-favorite-button" data-type="CatalogItem" data-id="639" data-name="Managing Deployments Using Kubernetes Engine" href="/favorite.json?item_id=639&amp;item_type=CatalogItem"><ql-icon>favorite_border</ql-icon>
</a><div class='mdl-tooltip js-tooltip' for='CatalogItem-639-favorite-button'>
Add to favorites
</div>



<ql-icon-button id='control-panel-target' style='display: none;'>
dashboard
</ql-icon-button>
<ql-menu for='control-panel-target' id='control-panel-menu'></ql-menu>

<ql-icon-button id='help-menu-button'>help</ql-icon-button>
<div class='mdl-tooltip js-tooltip' data-mdl-for='help-menu-button'>
Help
</div>
<ql-menu for='help-menu-button' id='help-menu'>
<ql-menu-item>
<ql-help context='lab' data-analytics-action='opened_help' data-analytics-label='lab' productdata='{&quot;userId&quot;:3894861}'>
Help Center
</ql-help>
</ql-menu-item>
<ql-menu-item>
<a target="_blank" class="ql-body-1" href="https://support.google.com/qwiklabs/contact/contact_us">Email support</a>
</ql-menu-item>
</ql-menu>

<ql-icon-button id='language'>language</ql-icon-button>
<div class='mdl-menu mdl-menu__bottom-right mdl-js-menu elevation-3' for='language'>
<a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ar" href="/focuses/639?locale=ar&amp;parent=catalog">العربية‬‎
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="de" href="/focuses/639?locale=de&amp;parent=catalog">Deutsch
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="en" href="/focuses/639?locale=en&amp;parent=catalog">English
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="es" href="/focuses/639?locale=es&amp;parent=catalog">español (Latinoamérica)
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="fr" href="/focuses/639?locale=fr&amp;parent=catalog">français
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="id" href="/focuses/639?locale=id&amp;parent=catalog">bahasa Indonesia
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="it" href="/focuses/639?locale=it&amp;parent=catalog">Italiano
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ja" href="/focuses/639?locale=ja&amp;parent=catalog">日本語
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ko" href="/focuses/639?locale=ko&amp;parent=catalog">한국어
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="pl" href="/focuses/639?locale=pl&amp;parent=catalog">Polski
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="pt_BR" href="/focuses/639?locale=pt_BR&amp;parent=catalog">português (Brasil)
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="pt_PT" href="/focuses/639?locale=pt_PT&amp;parent=catalog">português (Portugal)
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ru" href="/focuses/639?locale=ru&amp;parent=catalog">русский
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="tr" href="/focuses/639?locale=tr&amp;parent=catalog">Türkçe
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="zh" href="/focuses/639?locale=zh&amp;parent=catalog">简体中文
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="zh_TW" href="/focuses/639?locale=zh_TW&amp;parent=catalog">繁體中文
</a></div>
<button class='icon-button' id='my_account'>
<ql-avatar src='https://lh3.googleusercontent.com/a-/AOh14Gh6Bmcr7vfcCi5iPAH2qDeJgSaD6RLv1Muiv9mceA=s320-c'></ql-avatar>
</button>
<ql-menu for='my_account' open>
<div class='my-account-menu'>
<ql-avatar class='l-mtl l-mbl' size='120' src='https://lh3.googleusercontent.com/a-/AOh14Gh6Bmcr7vfcCi5iPAH2qDeJgSaD6RLv1Muiv9mceA=s320-c'></ql-avatar>
<div class='my-account-menu__user-info l-mbl'>
<h4 class='ql-subhead-1'>DANIEL ENRIQUE SANDOVAL SANCHEZ</h4>
<p class='ql-body-2 text--light'>desandovals@liverpool.com.mx</p>
<p class='ql-body-2 text--light'>
</p>
<a class="text--green ql-subhead-2" href="/my_account/payments"><ql-chip positive>
1874 Credits
</ql-chip>
</a></div>
<div class='buttons l-mbl'>
<a class="button button--hairline l-mrm" id="profile" href="/public_profiles/7a1e8d39-fa01-4103-ac38-c0184ccdbd0c">Profile</a>
<a class="button button--hairline" id="settings" href="/my_account/profile">Settings</a>
</div>
<hr>
<ql-button data-analytics-action='clicked_sign_out' href='/users/sign_out' method='delete'>
Sign Out
</ql-button>
<div class='privacy l-mtl'>
<a class="ql-caption text--light" href="/privacy_policy">Privacy</a>
<span class='ql-caption text--light l-mls l-mrs'>&middot;</span>
<a class="ql-caption text--light" href="/terms_of_service">Terms</a>
</div>
</div>
</ql-menu>

</div>
</div>
<div class='header__search-bar js-header-search-bar'>
<form class="js-search-form-mobile" onsubmit="ql.searchFilter(); return false;" action="/searches/elasticsearch" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="u8PYZX/NdBrU/vk2XGmSgEOfhz11dd5C4JKj/zAdgB4rTc9UXyZiRzY2ljn+AkwTwPw2Ow7XAEv4d7wXMbHQKg==" />
<input type="text" name="keywords" id="keywords" placeholder="Search" maxlength="255" aria-label="catalog search bar" />
</form>

<ql-icon-button class='js-close-search-bar'>close</ql-icon-button>
</div>
</div>

<nav class='nav-bar'>
<a class="nav-bar__item js-navigation-button" href="/"><ql-icon class='nav-bar__item__icon'>
home
</ql-icon>
<span class='nav-bar__item__label'>
Home
</span>
</a>
<a class="nav-bar__item js-navigation-button  active" aria-current="page" href="/catalog"><ql-icon class='nav-bar__item__icon'>
school
</ql-icon>
<span class='nav-bar__item__label'>
Catalog
</span>
</a>
<a class="nav-bar__item js-navigation-button" href="/my_learning"><ql-icon class='nav-bar__item__icon'>
event_note
</ql-icon>
<span class='nav-bar__item__label'>
My Learning
</span>
</a>
</nav>

<nav class='nav-panel js-nav-panel'>
<div class='nav-panel__logo'>
<div class='logo logo--blue'></div>
</div>
<a title="Home" tabindex="-1" class="nav-panel__item js-navigation-button" href="/"><ql-icon class='nav-panel__item__icon'>
home
</ql-icon>
<div class='nav-panel__item__label'>
Home
</div>
</a>
<a title="Catalog" tabindex="-1" class="nav-panel__item js-navigation-button active" aria-current="page" href="/catalog"><ql-icon class='nav-panel__item__icon'>
school
</ql-icon>
<div class='nav-panel__item__label'>
Catalog
</div>
</a>
<a title="My Learning" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_learning"><ql-icon class='nav-panel__item__icon'>
event_note
</ql-icon>
<div class='nav-panel__item__label'>
My Learning
</div>
</a>
<div class='nav-panel__spacer'></div>
<a title="Profile" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/profile"><ql-icon class='nav-panel__item__icon'>
account_circle
</ql-icon>
<div class='nav-panel__item__label'>
Profile
</div>
</a>
<a title="Credits &amp; Subscriptions" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/credits"><ql-icon class='nav-panel__item__icon'>
money
</ql-icon>
<div class='nav-panel__item__label'>
Credits &amp; Subscriptions
</div>
</a>
<a title="Security" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/security"><ql-icon class='nav-panel__item__icon'>
security
</ql-icon>
<div class='nav-panel__item__label'>
Security
</div>
</a>
<div class='nav-panel__spacer'></div>
<a class="nav-panel__item" tabindex="-1" href="#"><ql-help>
<div class='nav-panel__help-item'>
<ql-icon class='nav-panel__item__icon'>help</ql-icon>
<div class='nav-panel__item__label'>
Help
</div>
</div>
</ql-help>
</a><div class='nav-panel__small-links'>
<a tabindex="-1" href="/privacy_policy">Privacy</a>
<a tabindex="-1" href="/terms_of_service">Terms</a>
</div>
</nav>
<div class='nav-panel__overlay js-nav-toggle'></div>

<main class='js-main'>
<div class='l-main-wrapper' id='main-wrapper'>







<div class='lab-assessment__tab js-open-lab-assessment-panel'>
<h6 class='js-lab-assessment-total-score'>
&mdash;/100
</h6>
</div>
<div class='lab-assessment__panel js-lab-assessment-panel'>
<div class='lab-assessment__panel__header'>
<h4>Checkpoints</h4>
<ql-icon-button class='js-close-lab-assessment-panel'>arrow_forward</ql-icon-button>
</div>
<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Create a Kubernetes cluster and deployments (Auth, Hello, and Frontend)
</p>
<div class='lab-assessment__step__action'>
<a class='button js-show-run-step-button' step_no='1'>
Check my progress
</a>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-1'>
</span>
/ 50
</p>
</div>
</div>

<div class='lab-assessment__step'>
<p class='lab-assessment__step__title'>
Canary Deployment
</p>
<div class='lab-assessment__step__action'>
<a class='button js-show-run-step-button' step_no='2'>
Check my progress
</a>
<p class='lab-assessment__step__score'>
<span class='js-assessment-step-score-2'>
</span>
/ 50
</p>
</div>
</div>

</div>
<ql-drawer-container class='js-lab-state' data-analytics-payload='{&quot;label&quot;:&quot;Managing Deployments Using Kubernetes Engine&quot;,&quot;lab_name&quot;:&quot;Managing Deployments Using Kubernetes Engine&quot;,&quot;classroom_name&quot;:null,&quot;deployment&quot;:&quot;run&quot;}' data-focus-id='639' data-lab-billing-limit='0.0' data-lab-duration='3600' data-parent='catalog' data-payment-required data-recaptcha-enabled id='lab-container'>
<ql-drawer id='terminal-drawer' slot='drawer' style='width: calc(100% - 480px)'>
<iframe allow='clipboard-read' class='terminal' id='embedded-resource'></iframe>
</ql-drawer>
<ql-drawer-content class='js-lab-wrapper' id='lab-content' slot='drawer-content'>
<ql-drawer-container id='lab-content-container'>
<ql-drawer id='control-panel-drawer' open slot='drawer' width='320'>
<ql-lab-control-panel class='ql-lab-control-panel__max-height control-panel js-lab-control-panel' connectionFiles='[]' labControlButton='{&quot;disabled&quot;:false,&quot;pending&quot;:false,&quot;running&quot;:false}' labDetails='[]' labTimer='{&quot;ticking&quot;:false,&quot;secondsRemaining&quot;:3600}' studentResources='[]'>
<script src="https://www.recaptcha.net/recaptcha/api.js?render=6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr"   ></script>
        <script>
          // Define function so that we can call it again later if we need to reset it
          // This executes reCAPTCHA and then calls our callback.
          function executeRecaptchaForStartLab() {
            grecaptcha.ready(function() {
              grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}).then(function(token) {
                setInputWithRecaptchaResponseTokenForStartLab('g-recaptcha-response-data-start-lab', token)
              });
            });
          };
          // Invoke immediately
          executeRecaptchaForStartLab()

          // Async variant so you can await this function from another async function (no need for
          // an explicit callback function then!)
          // Returns a Promise that resolves with the response token.
          async function executeRecaptchaForStartLabAsync() {
            return new Promise((resolve, reject) => {
              grecaptcha.ready(async function() {
                resolve(await grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}))
              });
            })
          };

                    var setInputWithRecaptchaResponseTokenForStartLab = function(id, token) {
            var element = document.getElementById(id);
            element.value = token;
          }

        </script>
<input type="hidden" name="g-recaptcha-response-data[start_lab]" id="g-recaptcha-response-data-start-lab" data-sitekey="6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr" class="g-recaptcha g-recaptcha-response "/>

<div class='hidden' id='recaptcha-v2-start-lab' slot='recaptcha'>
<script src="https://www.recaptcha.net/recaptcha/api.js" async defer ></script>
<div data-sitekey="6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV" data-callback="recaptchaComplete" data-expired-callback="expireV2Token" class="g-recaptcha "></div>
          <noscript>
            <div>
              <div style="width: 302px; height: 422px; position: relative;">
                <div style="width: 302px; height: 422px; position: absolute;">
                  <iframe
                    src="https://www.recaptcha.net/recaptcha/api/fallback?k=6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV"
                    name="ReCAPTCHA"
                    style="width: 302px; height: 422px; border-style: none; border: 0; overflow: hidden;">
                  </iframe>
                </div>
              </div>
              <div style="width: 300px; height: 60px; border-style: none;
                bottom: 12px; left: 25px; margin: 0px; padding: 0px; right: 25px;
                background: #f9f9f9; border: 1px solid #c1c1c1; border-radius: 3px;">
                <textarea id="g-recaptcha-response" name="g-recaptcha-response"
                  class="g-recaptcha-response"
                  style="width: 250px; height: 40px; border: 1px solid #c1c1c1;
                  margin: 10px 25px; padding: 0px; resize: none;">
                </textarea>
              </div>
            </div>
          </noscript>

</div>
</ql-lab-control-panel>
</ql-drawer>
<ql-drawer-content id='lab-instructions' slot='drawer-content'>
<div class='alert alert--fake js-alert'>
<p class='alert__message js-alert-message'></p>
<a class='alert__close js-alert-close'>
<i class='fa fa-times'></i>
</a>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='js-lab-content lab-content__renderable-instructions'>
<div class='lab-preamble'>
<h1 class='lab-preamble__title'>
Managing Deployments Using Kubernetes Engine
</h1>
<div class='lab-preamble__details subtitle-headline-1'>
<span>1 hour </span>
<span>7 Credits</span>
<div class='lab__rating'>
<a href="/focuses/639/reviews?parent=catalog"><div class='rateit' data-rateit-readonly='true' data-rateit-value='4.2624'></div>

</a><a data-target='#lab-review-modal' data-toggle='modal'>
Rate Lab
</a>
</div>
</div>
</div>

<div class='js-markdown-instructions markdown-lab-instructions' id='markdown-lab-instructions'>



<h2 id="step1">GSP053</h2>
<p><img alt="Google Cloud Self-Paced Labs" src="https://cdn.qwiklabs.com/GMOHykaqmlTHiqEeQXTySaMXYPHeIvaqa2qHEzw6Occ%3D"></p>

<h2 id="step2">Overview</h2>
<p>Dev Ops practices will regularly make use of multiple deployments to manage application deployment scenarios such as "Continuous Deployment", "Blue-Green Deployments", "Canary Deployments" and more. This lab is to provide practice in scaling and managing containers so you can accomplish these common scenarios where multiple heterogeneous deployments are being used.</p>
<h3><strong>What you'll do</strong></h3>
<ul>
<li>Practice with kubectl tool</li>
<li>Create deployment yaml files</li>
<li>Launch, update, and scale deployments</li>
<li>Practice with updating deployments and deployment styles</li>
</ul>
<h3>Prerequisites</h3>
<ul>
<li>Before taking this lab, you should have taken at least the labs <a href="https://google.qwiklabs.com/catalog_lab/944" target="_blank">Introduction to Docker</a> and <a href="https://google.qwiklabs.com/catalog_lab/468" target="_blank">Hello Node Kubernetes</a>
</li>
<li>Linux System Administration skills</li>
<li>Dev Ops theory: concepts of continuous deployment</li>
</ul>
<h2 id="step3">Introduction to deployments</h2>
<p>Heterogeneous deployments typically involve connecting two or more distinct infrastructure environments or regions to address a specific technical or operational need. Heterogeneous deployments are called "hybrid", "multi-cloud", or "public-private", depending upon the specifics of the deployment. For the purposes of this lab, heterogeneous deployments include those that span regions within a single cloud environment, multiple public cloud environments (multi-cloud), or a combination of on-premises and public cloud environments (hybrid or public-private).</p>
<p>Various business and technical challenges can arise in deployments that are limited to a single environment or region:</p>
<ul>
<li>
<strong>Maxed out resources</strong>: In any single environment, particularly in on-premises environments, you might not have the compute, networking, and storage resources to meet your production needs.</li>
<li>
<strong>Limited geographic reach</strong>: Deployments in a single environment require people who are geographically distant from one another to access one deployment. Their traffic might travel around the world to a central location.</li>
<li>
<strong>Limited availability</strong>: Web-scale traffic patterns challenge applications to remain fault-tolerant and resilient.</li>
<li>
<strong>Vendor lock-in</strong>: Vendor-level platform and infrastructure abstractions can prevent you from porting applications.</li>
<li>
<strong>Inflexible resources</strong>: Your resources might be limited to a particular set of compute, storage, or networking offerings.</li>
</ul>
<p>Heterogeneous deployments can help address these challenges, but they must be architected using programmatic and deterministic processes and procedures. One-off or ad-hoc deployment procedures can cause deployments or processes to be brittle and intolerant of failures. Ad-hoc processes can lose data or drop traffic. Good deployment processes must be repeatable and use proven approaches for managing provisioning, configuration, and maintenance.</p>
<p>Three common scenarios for heterogeneous deployment are multi-cloud deployments, fronting on-premises data, and continuous integration/continuous delivery (CI/CD) processes.</p>
<p>The following exercises practice some common use cases for heterogeneous deployments, along with well-architected approaches using Kubernetes and other infrastructure resources to accomplish them.</p>
<h2 id="step4">Setup</h2>
<h4>Before you click the Start Lab button</h4>
<p>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click <strong>Start Lab</strong>, shows how long Google Cloud resources will be made available to you.</p>
<p>This Qwiklabs hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</p>
<h4>What you need</h4>
<p>To complete this lab, you need:</p>
<ul>
<li>Access to a standard internet browser (Chrome browser recommended).</li>
<li>Time to complete the lab.</li>
</ul>
<p><strong>Note:</strong> If you already have your own personal Google Cloud account or project, do not use it for this lab.</p>
<p><strong>Note:</strong> If you are using a Pixelbook, open an Incognito window to run this lab.</p>

<h4>How to start your lab and sign in to the Google Cloud Console</h4>
<ol>
<li>
<p>Click the <strong>Start Lab</strong> button. If you need to pay for the lab, a pop-up opens for you to select your payment method.
On the left is a panel populated with the temporary credentials that you must use for this lab.</p>
<p><img alt="Open Google Console" src="https://cdn.qwiklabs.com/%2FtHp4GI5VSDyTtdqi3qDFtevuY014F88%2BFow%2FadnRgE%3D"></p>
</li>
<li>
<p>Copy the username, and then click <strong>Open Google Console</strong>.
The lab spins up resources, and then opens another tab that shows the <strong>Sign in</strong> page.</p>
<p><img alt="Sign in" src="https://cdn.qwiklabs.com/VkUIAFY2xX3zoHgmWqYKccRLwFrR4BfARLd5ojmlbhs%3D"></p>
<p><strong><em>Tip:</em></strong> Open the tabs in separate windows, side-by-side.</p>
<aside>
 If you see the <strong>Choose an account</strong> page, click <strong>Use Another Account</strong>.
<img alt="Choose an account" src="https://cdn.qwiklabs.com/eQ6xPnPn13GjiJP3RWlHWwiMjhooHxTNvzfg1AL2WPw%3D">
</aside>
</li>
<li>
<p>In the <strong>Sign in</strong> page, paste the username that you copied from the Connection Details panel. Then copy and paste the password.</p>
<p><strong><em>Important:</em></strong> You must use the credentials from the Connection Details panel. Do not use your Qwiklabs credentials. If you have your own Google Cloud account, do not use it for this lab (avoids incurring charges).</p>
</li>
<li>
<p>Click through the subsequent pages:</p>
<ul>
<li>Accept the terms and conditions.</li>
<li>Do not add recovery options or two-factor authentication (because this is a temporary account).</li>
<li>Do not sign up for free trials.</li>
</ul>
</li>
</ol>
<p>After a few moments, the Cloud Console opens in this tab.</p>
<aside>
<strong>Note:</strong> You can view the menu with a list of Google Cloud Products and Services by clicking the <strong>Navigation menu</strong> at the top-left.
<img alt="Cloud Console Menu" src="https://cdn.qwiklabs.com/9vT7xPlxoNP%2FPsK0J8j0ZPFB4HnnpaIJVCDByaBrSHg%3D">
</aside>

<h3>Activate Cloud Shell</h3>
<p>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</p>
<p>In the Cloud Console, in the top right toolbar, click the <strong>Activate Cloud Shell</strong> button.</p>
<p><img alt="Cloud Shell icon" src="https://cdn.qwiklabs.com/vdY5e%2Fan9ZGXw5a%2FZMb1agpXhRGozsOadHURcR8thAQ%3D"></p>
<p>Click <strong>Continue</strong>.</p>
<p><img alt="cloudshell_continue.png" src="https://cdn.qwiklabs.com/lr3PBRjWIrJ%2BMQnE8kCkOnRQQVgJnWSg4UWk16f0s%2FA%3D"></p>
<p>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your <em>PROJECT_ID</em>. For example:</p>
<p><img alt="Cloud Shell Terminal" src="https://cdn.qwiklabs.com/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D"></p>
<p><code>gcloud</code> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</p>
<p>You can list the active account name with this command:</p>
<pre><code>gcloud auth list&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-output prettyprint">Credentialed accounts:&#x000A; - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)&#x000A;</code></pre>
<p>(Example output)</p>
<pre><code class="language-Output prettyprint">Credentialed accounts:&#x000A; - google1623327_student@qwiklabs.net&#x000A;</code></pre>
<p>You can list the project ID with this command:</p>
<pre><code>gcloud config list project&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-output prettyprint">[core]&#x000A;project = &lt;project_ID&gt;&#x000A;</code></pre>
<p>(Example output)</p>
<pre><code class="language-Output prettyprint">[core]&#x000A;project = qwiklabs-gcp-44776a13dea667a6&#x000A;</code></pre>
<aside>
  For full documentation of <code>gcloud</code> see the <a href="https://cloud.google.com/sdk/gcloud" target="_blank">gcloud command-line tool overview</a>.

</aside>

<h3>Set zone</h3>
<p>Set your working Google Cloud zone by running the following command, substituting the local zone as <code>us-central1-a</code>:</p>
<pre><code>gcloud config set compute/zone us-central1-a&#x000A;</code></pre>
<h3>Get sample code for this lab</h3>
<p>Get the sample code for creating and running containers and deployments:</p>
<pre><code>gsutil -m cp -r gs://spls/gsp053/orchestrate-with-kubernetes .&#x000A;cd orchestrate-with-kubernetes/kubernetes&#x000A;</code></pre>
<p>Create a cluster with five <code>n1-standard-1</code> nodes (this will take a few minutes to complete):</p>
<pre><code>gcloud container clusters create bootcamp --num-nodes 5 --scopes "https://www.googleapis.com/auth/projecthosting,storage-rw"&#x000A;</code></pre>
<h2 id="step5">Learn about the deployment object</h2>
<p>Let's get started with Deployments. First let's take a look at the Deployment object. The <code>explain</code>  command in <code>kubectl</code> can tell us about the Deployment object.</p>
<pre><code>kubectl explain deployment&#x000A;</code></pre>
<p>We can also see all of the fields using the <code>--recursive</code> option.</p>
<pre><code>kubectl explain deployment --recursive&#x000A;</code></pre>
<p>You can use the explain command as you go through the lab to help you understand the structure of a Deployment object and understand what the individual fields do.</p>
<pre><code>kubectl explain deployment.metadata.name&#x000A;</code></pre>
<h2 id="step6">Create a deployment</h2>
<p>Update the <code>deployments/auth.yaml</code> configuration file:</p>
<pre><code>vi deployments/auth.yaml&#x000A;</code></pre>
<p>Start the editor:</p>
<pre><code>i&#x000A;</code></pre>
<p>Change the <code>image</code> in the containers section of the Deployment to the following:</p>
<pre><code>...&#x000A;containers:&#x000A;- name: auth&#x000A;  image: "kelseyhightower/auth:1.0.0"&#x000A;...&#x000A;</code></pre>
<p>Save the <code>auth.yaml</code> file: press <code>&lt;Esc&gt;</code> then type:</p>
<pre><code>:wq&#x000A;</code></pre>
<p>Press <code>&lt;Enter&gt;</code>. Now let's create a simple deployment. Examine the deployment configuration file:</p>
<pre><code>cat deployments/auth.yaml&#x000A;</code></pre>
<p>(Output)</p>
<pre><code>apiVersion: apps/v1&#x000A;kind: Deployment&#x000A;metadata:&#x000A;  name: auth&#x000A;spec:&#x000A;  replicas: 1&#x000A;  selector:&#x000A;    matchLabels:&#x000A;      app: auth&#x000A;  template:&#x000A;    metadata:&#x000A;      labels:&#x000A;        app: auth&#x000A;        track: stable&#x000A;    spec:&#x000A;      containers:&#x000A;        - name: auth&#x000A;          image: "kelseyhightower/auth:1.0.0"&#x000A;          ports:&#x000A;            - name: http&#x000A;              containerPort: 80&#x000A;            - name: health&#x000A;              containerPort: 81&#x000A;...&#x000A;</code></pre>
<p>Notice how the Deployment is creating one replica and it's using version 1.0.0 of the auth container.</p>
<p>When you run the <code>kubectl create</code> command to create the auth deployment, it will make one pod that conforms to the data in the Deployment manifest. This means we can scale the number of Pods by changing the number specified in the <code>replicas</code> field.</p>
<p>Go ahead and create your deployment object using <code>kubectl create</code>:</p>
<pre><code>kubectl create -f deployments/auth.yaml&#x000A;</code></pre>
<p>Once you have created the Deployment, you can verify that it was created.</p>
<pre><code>kubectl get deployments&#x000A;</code></pre>
<p>Once the deployment is created, Kubernetes will create a ReplicaSet for the Deployment. We can verify that a ReplicaSet was created for our Deployment:</p>
<pre><code>kubectl get replicasets&#x000A;</code></pre>
<p>We should see a ReplicaSet with a name like <code>auth-xxxxxxx</code></p>
<p>Finally, we can view the Pods that were created as part of our Deployment. The single Pod is created by the Kubernetes when the ReplicaSet is created.</p>
<pre><code>kubectl get pods&#x000A;</code></pre>
<p>It's time to create a service for our auth deployment. You've already seen service manifest files, so we won't go into the details here. Use the <code>kubectl create</code> command to create the auth service.</p>
<pre><code>kubectl create -f services/auth.yaml&#x000A;</code></pre>
<p>Now, do the same thing to create and expose the hello Deployment.</p>
<pre><code>kubectl create -f deployments/hello.yaml&#x000A;kubectl create -f services/hello.yaml&#x000A;</code></pre>
<p>And one more time to create and expose the frontend Deployment.</p>
<pre><code>kubectl create secret generic tls-certs --from-file tls/&#x000A;kubectl create configmap nginx-frontend-conf --from-file=nginx/frontend.conf&#x000A;kubectl create -f deployments/frontend.yaml&#x000A;kubectl create -f services/frontend.yaml&#x000A;</code></pre>
<ql-infobox><strong>Note:</strong> You created a ConfigMap for the frontend.</ql-infobox>
<p>Interact with the frontend by grabbing its external IP and then curling to it.</p>
<pre><code>kubectl get services frontend&#x000A;</code></pre>
<ql-warningbox>It may take a few seconds before the External-IP field is populated for your service. This is normal. Just re-run the above command every few seconds until the field is populated.</ql-warningbox>
<pre><code>curl -ks https://&lt;EXTERNAL-IP&gt;&#x000A;</code></pre>
<p>And you get the hello response back.</p>
<p>You can also use the output templating feature of <code>kubectl</code> to use curl as a one-liner:</p>
<pre><code>curl -ks https://`kubectl get svc frontend -o=jsonpath="{.status.loadBalancer.ingress[0].ip}"`&#x000A;</code></pre>
<h4>Test Completed Task</h4>
<p>Click <strong>Check my progress</strong> below to check your lab progress. If you successfully created Kubernetes cluster and Auth, Hello and Frontend deployments, you'll see an assessment score.</p>
<ql-activity-tracking step="1">
    Create a Kubernetes cluster and deployments (Auth, Hello, and Frontend)
</ql-activity-tracking>
<h3>Scale a Deployment</h3>
<p>Now that we have a Deployment created, we can scale it. Do this by updating the <code>spec.replicas</code> field. You can look at an explanation of this field using the <code>kubectl explain</code> command again.</p>
<pre><code>kubectl explain deployment.spec.replicas&#x000A;</code></pre>
<p>The replicas field can be most easily updated using the <code>kubectl scale</code> command:</p>
<pre><code>kubectl scale deployment hello --replicas=5&#x000A;</code></pre>
<ql-warningbox><strong>Note:</strong> It may take a minute or so for all the new pods to start up.</ql-warningbox>
<p>After the Deployment is updated, Kubernetes will automatically update the associated ReplicaSet and start new Pods to make the total number of Pods equal 5.</p>
<p>Verify that there are now 5 <code>hello</code> Pods running:</p>
<pre><code>kubectl get pods | grep hello- | wc -l&#x000A;</code></pre>
<p>Now scale back the application:</p>
<pre><code>kubectl scale deployment hello --replicas=3&#x000A;</code></pre>
<p>Again, verify that you have the correct number of Pods.</p>
<pre><code>kubectl get pods | grep hello- | wc -l&#x000A;</code></pre>
<p>You learned about Kubernetes deployments and how to manage &amp; scale a group of Pods.</p>
<h2 id="step7">Rolling update</h2>
<p>Deployments support updating images to a new version through a rolling update mechanism. When a Deployment is updated with a new version, it creates a new ReplicaSet and slowly increases the number of replicas in the new ReplicaSet as it decreases the replicas in the old ReplicaSet.</p>
<p><img alt="8d107e36763fd5c1.png" src="https://cdn.qwiklabs.com/uc6D9jQ5Blkv8wf%2FccEcT35LyfKDHz7kFpsI4oHUmb0%3D"></p>
<h3>Trigger a rolling update</h3>
<p>To update your Deployment, run the following command:</p>
<pre><code>kubectl edit deployment hello&#x000A;</code></pre>
<p>Change the <code>image</code> in the containers section of the Deployment to the following:</p>
<pre><code>...&#x000A;containers:&#x000A;  image: kelseyhightower/hello:2.0.0&#x000A;...&#x000A;</code></pre>
<p>Save and exit.</p>
<p>Once you save out of the editor, the updated Deployment will be saved to your cluster and Kubernetes will begin a rolling update.</p>
<p>See the new ReplicaSet that Kubernetes creates.:</p>
<pre><code>kubectl get replicaset&#x000A;</code></pre>
<p>You can also see a new entry in the rollout history:</p>
<pre><code>kubectl rollout history deployment/hello&#x000A;</code></pre>
<h3>Pause a rolling update</h3>
<p>If you detect problems with a running rollout, pause it to stop the update. Give that a try now:</p>
<pre><code>kubectl rollout pause deployment/hello&#x000A;</code></pre>
<p>Verify the current state of the rollout:</p>
<pre><code>kubectl rollout status deployment/hello&#x000A;</code></pre>
<p>You can also verify this on the Pods directly:</p>
<pre><code>kubectl get pods -o jsonpath --template='{range .items[*]}{.metadata.name}{"\t"}{"\t"}{.spec.containers[0].image}{"\n"}{end}'&#x000A;</code></pre>
<h3>Resume a rolling update</h3>
<p>The rollout is paused which means that some pods are at the new version and some pods are at the older version. We can continue the rollout using the <code>resume</code> command.</p>
<pre><code>kubectl rollout resume deployment/hello&#x000A;</code></pre>
<p>When the rollout is complete, you should see the following when running the <code>status</code> command.</p>
<pre><code>kubectl rollout status deployment/hello&#x000A;</code></pre>
<p>(Output)</p>
<pre><code>deployment "hello" successfully rolled out&#x000A;</code></pre>
<h3>Rollback an update</h3>
<p>Assume that a bug was detected in your new version. Since the new version is presumed to have problems, any users connected to the new Pods will experience those issues.</p>
<p>You will want to roll back to the previous version so you can investigate and then release a version that is fixed properly.</p>
<p>Use the <code>rollout</code> command to roll back to the previous version:</p>
<pre><code>kubectl rollout undo deployment/hello&#x000A;</code></pre>
<p>Verify the roll back in the history:</p>
<pre><code>kubectl rollout history deployment/hello&#x000A;</code></pre>
<p>Finally, verify that all the Pods have rolled back to their previous versions:</p>
<pre><code>kubectl get pods -o jsonpath --template='{range .items[*]}{.metadata.name}{"\t"}{"\t"}{.spec.containers[0].image}{"\n"}{end}'&#x000A;</code></pre>
<p>Great! You learned about rolling updates for Kubernetes deployments and how to update applications without downtime.</p>
<h2 id="step8">Canary deployments</h2>
<p>When you want to test a new deployment in production with a subset of your users, use a canary deployment. Canary deployments allow you to release a change to a small subset of your users to mitigate risk associated with new releases.</p>
<h3>Create a canary deployment</h3>
<p>A canary deployment consists of a separate deployment with your new version and a service that targets both your normal, stable deployment as well as your canary deployment.</p>
<p><img alt="48190cf58fdf2eeb.png" src="https://cdn.qwiklabs.com/qSrgIP5FyWKEbwOk3PMPAALJtQoJoEpgJMVwauZaZow%3D"></p>
<p>First, create a new canary deployment for the new version:</p>
<pre><code>cat deployments/hello-canary.yaml&#x000A;</code></pre>
<p>(Output)</p>
<pre><code>apiVersion: apps/v1&#x000A;kind: Deployment&#x000A;metadata:&#x000A;  name: hello-canary&#x000A;spec:&#x000A;  replicas: 1&#x000A;  selector:&#x000A;    matchLabels:&#x000A;      app: hello&#x000A;  template:&#x000A;    metadata:&#x000A;      labels:&#x000A;        app: hello&#x000A;        track: canary&#x000A;        # Use ver 2.0.0 so it matches version on service selector&#x000A;        version: 2.0.0&#x000A;    spec:&#x000A;      containers:&#x000A;        - name: hello&#x000A;          image: kelseyhightower/hello:2.0.0&#x000A;          ports:&#x000A;            - name: http&#x000A;              containerPort: 80&#x000A;            - name: health&#x000A;              containerPort: 81&#x000A;...&#x000A;</code></pre>
<p>Now create the canary deployment:</p>
<pre><code>kubectl create -f deployments/hello-canary.yaml&#x000A;</code></pre>
<p>After the canary deployment is created, you should have two deployments, <code>hello</code> and <code>hello-canary</code>. Verify it with this  <code>kubectl</code> command:</p>
<pre><code>kubectl get deployments&#x000A;</code></pre>
<p>On the <code>hello</code> service, the selector uses the <code>app:hello</code> selector which will match pods in <strong>both</strong> the prod deployment and canary deployment. However, because the canary deployment has a fewer number of pods, it will be visible to fewer users.</p>
<h3>Verify the canary deployment</h3>
<p>You can verify the <code>hello</code> version being served by the request:</p>
<pre><code>curl -ks https://`kubectl get svc frontend -o=jsonpath="{.status.loadBalancer.ingress[0].ip}"`/version&#x000A;</code></pre>
<p>Run this several times and you should see that some of the requests are served by hello 1.0.0 and a small subset (1/4 = 25%) are served by 2.0.0.</p>
<h4>Test Completed Task</h4>
<p>Click <strong>Check my progress</strong> below to check your lab progress. If you successfully created Canary deployment, you'll see an assessment score.</p>
<ql-activity-tracking step="2">
    Canary Deployment
</ql-activity-tracking>
<h3>Canary deployments in production - session affinity</h3>
<p>In this lab, each request sent to the Nginx service had a chance to be served by the canary deployment. But what if you wanted to ensure that a user didn't get served by the Canary deployment? A use case could be that the UI for an application changed, and you don't want to confuse the user. In a case like this, you want the user to "stick" to one deployment or the other.</p>
<p>You can do this by creating a service with session affinity. This way the same user will always be served from the same version. In the example below the service is the same as before, but a new <code>sessionAffinity</code> field has been added, and set to ClientIP. All clients with the same IP address will have their requests sent to the same version of the <code>hello</code> application.</p>
<pre><code>kind: Service&#x000A;apiVersion: v1&#x000A;metadata:&#x000A;  name: "hello"&#x000A;spec:&#x000A;  sessionAffinity: ClientIP&#x000A;  selector:&#x000A;    app: "hello"&#x000A;  ports:&#x000A;    - protocol: "TCP"&#x000A;      port: 80&#x000A;      targetPort: 80&#x000A;</code></pre>
<p>Due to it being difficult to set up an environment to test this, you don't need to here, but you may want to use <code>sessionAffinity</code> for canary deployments in production.</p>
<h2 id="step9">Blue-green deployments</h2>
<p>Rolling updates are ideal because they allow you to deploy an application slowly with minimal overhead, minimal performance impact, and minimal downtime. There are instances where it is beneficial to modify the load balancers to point to that new version only after it has been fully deployed. In this case, blue-green deployments are the way to go.</p>
<p>Kubernetes achieves this by creating two separate deployments; one for the old "blue" version and one for the new "green" version. Use your existing <code>hello</code> deployment for the "blue" version. The deployments will be accessed via a Service which will act as the router. Once the new "green" version is up and running, you'll switch over to using that version by updating the Service.</p>
<p><img alt="9e624196fdaf4534.png" src="https://cdn.qwiklabs.com/POW8Q247ZKNY%2ByHIartCsoEu8MAih7k4u1twusCx6pw%3D"></p>
<ql-warningbox>A major downside of blue-green deployments is that you will need to have at least 2x the resources in your cluster necessary to host your application. Make sure you have enough resources in your cluster before deploying both versions of the application at once.</ql-warningbox>
<h3>The service</h3>
<p>Use the existing hello service, but update it so that it has a selector <code>app:hello</code>, <code>version: 1.0.0.</code> The selector will match the existing "blue" deployment. But it will not match the "green" deployment because it will use a different version.</p>
<p>First update the service:</p>
<pre><code>kubectl apply -f services/hello-blue.yaml&#x000A;</code></pre>
<ql-infobox><strong>NOTE:</strong> Ignore the warning that says <code>resource service/hello is missing</code> as this is patched automatically.</ql-infobox>
<h3>Updating using Blue-Green Deployment</h3>
<p>In order to support a blue-green deployment style, we will create a new "green" deployment for our new version. The green deployment updates the version label and the image path.</p>
<pre><code>apiVersion: apps/v1&#x000A;kind: Deployment&#x000A;metadata:&#x000A;  name: hello-green&#x000A;spec:&#x000A;  replicas: 3&#x000A;  selector:&#x000A;    matchLabels:&#x000A;      app: hello&#x000A;  template:&#x000A;    metadata:&#x000A;      labels:&#x000A;        app: hello&#x000A;        track: stable&#x000A;        version: 2.0.0&#x000A;    spec:&#x000A;      containers:&#x000A;        - name: hello&#x000A;          image: kelseyhightower/hello:2.0.0&#x000A;          ports:&#x000A;            - name: http&#x000A;              containerPort: 80&#x000A;            - name: health&#x000A;              containerPort: 81&#x000A;          resources:&#x000A;            limits:&#x000A;              cpu: 0.2&#x000A;              memory: 10Mi&#x000A;          livenessProbe:&#x000A;            httpGet:&#x000A;              path: /healthz&#x000A;              port: 81&#x000A;              scheme: HTTP&#x000A;            initialDelaySeconds: 5&#x000A;            periodSeconds: 15&#x000A;            timeoutSeconds: 5&#x000A;          readinessProbe:&#x000A;            httpGet:&#x000A;              path: /readiness&#x000A;              port: 81&#x000A;              scheme: HTTP&#x000A;            initialDelaySeconds: 5&#x000A;            timeoutSeconds: 1&#x000A;</code></pre>
<p>Create the green deployment:</p>
<pre><code>kubectl create -f deployments/hello-green.yaml&#x000A;</code></pre>
<p>Once you have a green deployment and it has started up properly, verify that the current version of 1.0.0 is still being used:</p>
<pre><code>curl -ks https://`kubectl get svc frontend -o=jsonpath="{.status.loadBalancer.ingress[0].ip}"`/version&#x000A;</code></pre>
<p>Now, update the service to point to the new version:</p>
<pre><code>kubectl apply -f services/hello-green.yaml&#x000A;</code></pre>
<p>With the service is updated, the "green" deployment will be used immediately. You can now verify that the new version is always being used.</p>
<pre><code>curl -ks https://`kubectl get svc frontend -o=jsonpath="{.status.loadBalancer.ingress[0].ip}"`/version&#x000A;</code></pre>
<h3>Blue-Green Rollback</h3>
<p>If necessary, you can roll back to the old version in the same way. While the "blue" deployment is still running, just update the service back to the old version.</p>
<pre><code>kubectl apply -f services/hello-blue.yaml&#x000A;</code></pre>
<p>Once you have updated the service, your rollback will have been successful. Again, verify that the right version is now being used:</p>
<pre><code>curl -ks https://`kubectl get svc frontend -o=jsonpath="{.status.loadBalancer.ingress[0].ip}"`/version&#x000A;</code></pre>
<p>You did it! You learned about blue-green deployments and how to deploy updates to applications that need to switch versions all at once.</p>
<h2 id="step10">Congratulations!</h2>
<p>This concludes this hands-on lab practicing deployment management with Kubernetes. In this lab you've had the opportunity to work more with the <code>kubectl</code> command-line tool, and many styles of deployment configurations set up in YAML files to launch, update, and scale your deployments. With this foundation of practice you should feel comfortable applying these skills to your own DevOps practice.</p>
<p><img alt="6d0798e24a18671b.png" src="https://cdn.qwiklabs.com/2LSNdbBU3lu0UqtX1hUrMEip%2BbKsc9ecpQe%2BXtIL9qY%3D">
<img alt="Solutions_Kubernetes_125.png" src="https://cdn.qwiklabs.com/oXLuFcP%2FRlKGYWLPwwrDJKHyrw2%2BfOIXz4gpVlezELY%3D">
<img alt="CloudEngineeringExaPrep_125.pmg" src="https://cdn.qwiklabs.com/jVIZEu1uWCkufNtCmqyElRifK5o%2FNRrtt5Vo9iZxHz8%3D">
<img alt="DevOpsTransparent_125.png" src="https://cdn.qwiklabs.com/Bps%2BnktWjZhTqr%2F8%2FRFUEB2uCuqNUM%2Fkz8a%2BMEwKWE4%3D"></p>
<h3>Finish your Quest</h3>
<p>This self-paced lab is part of the Qwiklabs <a href="https://google.qwiklabs.com/quests/29" target="_blank">Kubernetes in the Google Cloud</a>, <a href="https://google.qwiklabs.com/quests/45" target="_blank">Kubernetes Solutions</a>, <a href="https://google.qwiklabs.com/quests/66" target="_blank">Cloud Engineering</a>, and <a href="https://google.qwiklabs.com/quests/96" target="_blank">DevOps Essentials</a> Quests. A Quest is a series of related labs that form a learning path. Completing this Quest earns you the badge above, to recognize your achievement. You can make your badge public and link to them in your online resume or social media account.  Enroll in a Quest and get immediate completion credit if you've taken this lab.  <a href="https://google.qwiklabs.com/catalog" target="_blank">See other available Qwiklabs Quests</a>.</p>
<p>Looking for a hands-on challenge lab to demonstrate your Kubernetes skills and validate your knowledge? On completing this quest, finish this additional <a href="https://google.qwiklabs.com/catalog_lab/2524" target="_blank">challenge lab</a> to receive an exclusive Google Cloud digital badge.</p>
<p><img alt="final-deploy-kubernetes.png" src="https://cdn.qwiklabs.com/xX16cavGqOjZkoBJOK4FI4kvJf11HurY9BTtJFrx%2FpU%3D"></p>
<h3>Take your next lab</h3>
<p>Continue your Quest with these suggestions:</p>
<ul>
<li>
<p><a href="https://google.qwiklabs.com/catalog_lab/984" target="_blank">Continuous Delivery with Jenkins in Kubernetes Engine</a></p>
</li>
<li>
<p><a href="https://google.qwiklabs.com/catalog_lab/962" target="_blank">Using Kubernetes Engine to Deploy Apps with Regional Persistent Disks</a></p>
</li>
</ul>
<h3>Next steps / learn more</h3>
<ul>
<li>Read further on  <a href="https://cloud.google.com/solutions/heterogeneous-deployment-patterns-with-kubernetes" target="_blank">Deployment Patterns with Kubernetes</a>.</li>
<li>Read further on  <a href="https://cloud.google.com/solutions/devops/" target="_blank">DevOps Solutions and DevOps Guides</a> in the Google Cloud documentation</li>
<li>Connect with the  <a href="https://kubernetes.io/community/" target="_blank">Kubernetes Community</a>!</li>
</ul>
<h3>Google Cloud Training &amp; Certification</h3>
<p>...helps you make the most of Google Cloud technologies. <a href="https://cloud.google.com/training/courses" target="_blank">Our classes</a> include technical skills and best practices to help you get up to speed quickly and continue your learning journey. We offer fundamental to advanced level training, with on-demand, live, and virtual options to suit your busy schedule. <a href="https://cloud.google.com/certification/" target="_blank">Certifications</a> help you validate and prove your skill and expertise in Google Cloud technologies.</p>

<h5>Manual last updated May 17, 2021</h5>
<h5>Lab last tested May 17, 2021</h5>
<p>Copyright 2021 Google LLC All rights reserved. Google and the Google logo are trademarks of Google LLC. All other company and product names may be trademarks of the respective companies with which they are associated.</p>



</div>
</div>


<div class='hidden js-end-lab-button-container lab-content__end-lab-button'>
<ql-lab-control-button class='js-end-lab-button' running></ql-lab-control-button>
</div>
<!-- / TODO: Move recommendations into the end lab modal -->
<div class='lab-content__renderable-instructions'>
<div class='lab-content__recommendation'>
<!-- # TODO: Change classes so that this doesn't stack vertically -->
<section class='upcoming-cards'>
<h2 class='ql-headline-4'>Continue questing</h2>
<div class='content-card-grid'>
<div class='card-content-wrapper js-content-card' data-id='1583' data-level='Advanced' data-name='Site Reliability Troubleshooting with Cloud Monitoring APM' data-type='Lab'>
<a class="card card--content elevation-0 content-lab" href="/focuses/4186?parent=catalog"><div class='card__image'>
<div class='card__image__inner' style='background-image: url(https://cdn.qwiklabs.com/assets/fractal1-90735da7b9906552121e230998c46ac7e2e5f943f2c909a6da76f50d7e815976.jpg)'></div>
</div>
<div class='card__body'>
<div class='overline card--content__type'>
Lab
</div>
<h3 class='card--content__title'>
Site Reliability Troubleshooting with Cloud Monitori...
</h3>
<div class='card--content__description body-1'>
<p>
The objective of this lab is to familiarize yourself with the specific capabilities of Cloud Monitoring to monitor GKE cluster infrastructure, Istio, and applications deployed on this infrastructure.
</p>
</div>
</div>
<div class='card__footer'>
<div class='card__footer__left'>
<span>Advanced</span>
</div>
<div class='card__footer__right'>
<div class='rateit' data-rateit-readonly='true' data-rateit-value='3.7033'></div>
</div>
</div>
</a></div>

</div>
</section>

</div>

</div>
</ql-drawer-content>
<ql-drawer end id='outline-drawer' open slot='drawer' width='320'>
<div class='js-lab-content-outline lab-content__outline'>
<a href='#step1'>GSP053</a><a href='#step2'>Overview</a><a href='#step3'>Introduction to deployments</a><a href='#step4'>Setup</a><a href='#step5'>Learn about the deployment object</a><a href='#step6'>Create a deployment</a><a href='#step7'>Rolling update</a><a href='#step8'>Canary deployments</a><a href='#step9'>Blue-green deployments</a><a href='#step10'>Congratulations!</a>
</div>
</ql-drawer>
</ql-drawer-container>
</ql-drawer-content>
</ql-drawer-container>
<div class='lab-introduction js-lab-introduction is-hidden'>
<div class='lab-introduction__inner'>
<h1 class='headline-1'>Welcome to Your First Lab!</h1>
<ql-icon-button class='js-skip-button'>close</ql-icon-button>
<div class='lab-introduction__video'>
<iframe allow='autoplay; encrypted-media' allowfullscreen frameborder='0' id='lab-introduction' src='https://www.youtube.com/embed/yF7EDXKTmoQ?enablejsapi=1&amp;rel=0&amp;showinfo=0'></iframe>
</div>
<a class='js-skip-button button button--outline'>Skip this video</a>
</div>
</div>



</div>
</main>


<div class='modal fade' id='lab-details-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<div class='modal-body'>
<p class='l-mbm'>
Dev Ops best practices make use of multiple deployments to manage application deployment scenarios. This lab provides practice in scaling and managing containers to accomplish common scenarios where multiple heterogeneous deployments are used.
</p>
<p>
This lab is included in these quests:
<a href="/quests/24">Cloud Architecture</a>, <a href="/quests/29">Kubernetes in Google Cloud</a>, <a href="/quests/116">Deploy to Kubernetes in Google Cloud</a>, <a href="/quests/66">Cloud Engineering</a>, <a href="/quests/119">Set Up and Configure a Cloud Environment in Google Cloud</a>, <a href="/quests/96">DevOps Essentials</a>, <a href="/quests/141">Implement DevOps in Google Cloud</a>, <a href="/quests/45">Kubernetes Solutions</a>.
If you complete this lab you&#39;ll receive credit for it when you enroll in one of these quests.
</p>
<p class='small-label l-mbs'>
<strong>
Duration:
</strong>
0m setup
&middot;
60m access
&middot;
60m completion
</p>
<p class='small-label l-mbs'>
<span><strong>Levels: </strong>advanced</span>
</p>
<p class='small-label'>
<strong>
Permalink:
</strong>
<a href="https://www.qwiklabs.com/catalog_lab/572">https://www.qwiklabs.com/catalog_lab/572</a>
</p>
</div>
<div class='modal-actions'>
<a class='button button--text' data-dismiss='modal'>
Got It
</a>
</div>


</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='modal fade' id='lab-review-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<form class="simple_form js-lab-review-form" id="edit_lab_review_12464307" action="/lab_reviews/12464307" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="patch" /><div class='modal-body'>
<p class='label'>
How satisfied are you with this lab?*
</p>
<div class='rateit js-rateit' data-rateit-max='5' data-rateit-min='0' data-rateit-resetable='false' data-rateit-step='1' data-rateit-value='5'></div>
<div class='l-mtm'>

<div class="control-group hidden lab_review_user_id"><div class="controls"><input class="hidden" type="hidden" value="3894861" name="lab_review[user_id]" id="lab_review_user_id" /></div></div>
<div class="control-group hidden lab_review_classroom_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[classroom_id]" id="lab_review_classroom_id" /></div></div>
<div class="control-group hidden lab_review_lab_id"><div class="controls"><input class="hidden" type="hidden" value="572" name="lab_review[lab_id]" id="lab_review_lab_id" /></div></div>
<div class="control-group hidden lab_review_focus_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[focus_id]" id="lab_review_focus_id" /></div></div>
<div class="control-group hidden lab_review_rating"><div class="controls"><input class="hidden js-rating-input" type="hidden" value="2" name="lab_review[rating]" id="lab_review_rating" /></div></div>
<div class="control-group text optional lab_review_comment"><label class="text optional control-label" for="lab_review_comment">Comment</label><div class="controls"><textarea class="text optional" name="lab_review[comment]" id="lab_review_comment">
</textarea></div></div>
</div>
</div>
<div class='modal-actions'>
<a class='button button--text' data-dismiss='modal'>
Cancel
</a>
<input type="submit" name="commit" value="Submit" disabled="disabled" id="submit" data-disabled="false" class="button" data-disable-with="Submit" />
</div>
</form>

</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='modal fade' id='lab-access-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<a class='lab-access-modal-close' data-analytics-action='dismissed_lab_payment_modal' data-dismiss='modal'>
<i class='material-icons'>close</i>
</a>
<form class="js-lab-access-form" action="/lab_onetime_coupons/activate?parent=catalog" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />
<div class='modal-body'>
<div class='lab-access-modal'>
<input type="hidden" name="id" id="id" value="639" />
<input type="hidden" name="user_id" id="user_id" value="3894861" />
<input type="hidden" name="launch_with_credits" id="launch_with_credits" value="0" class="js-launch-with-credits-input" />
<input type="hidden" name="launch_with_subs" id="launch_with_subs" value="0" class="js-launch-with-subscription-input" />
<input type="hidden" name="launch_with_access_code" id="launch_with_access_code" value="0" class="js-launch-with-access-code" />
<div class='lab-access-modal__method'>
<p>
This lab costs
7 Credits.
</p>
<p>
1874 Credits
available
</p>
<a class='button js-launch-with-credits-button js-lab-access-modal-button' data-analytics-action='clicked_launch_with_credits_button'>
Launch with
7 Credits
</a>
</div>
<div class='lab-access-modal__method'>
<p>
Enter Lab Access Code:
</p>
<div class='lab-access-modal__code js-access-code'>
<input type="text" name="uuid_1" id="uuid_1" value="" maxlength="4" placeholder="1234" class="js-access-code-input" />
<input type="text" name="uuid_2" id="uuid_2" value="" maxlength="4" placeholder="1234" class="js-access-code-input" />
<input type="text" name="uuid_3" id="uuid_3" value="" maxlength="4" placeholder="1234" class="js-access-code-input" />
<input type="text" name="uuid_4" id="uuid_4" value="" maxlength="4" placeholder="1234" class="js-access-code-input" />
</div>
<a class='button js-launch-with-access-code-button js-lab-access-modal-button' data-analytics-action='clicked_launch_with_access_code_button'>
Launch with Access Code
</a>
</div>
</div>
</div>
</form>



</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>


<script>
  $( function() {
    ql.initMaterialInputs();
    initChosen();
    initSearch();
    initTabs();
    ql.list.init();
    ql.favoriting.init();
    ql.header.myAccount.init();
    initTooltips();
    ql.autocomplete.init();
    ql.modals.init();
    ql.toggleButtons.init();
    ql.analytics.init();
    ql.favoriting.init();
  ql.labControlPanel.addRecaptchaErrorHandler();
  initLabContent();
  ql.labOutline.links.init();
  initLabReviewModal();
  initLabAccessModal();
  ql.labAssessment.init();
  ql.labIntroduction.init( true );
  ql.labData.init();
  initLabTranslations( {"are_you_sure":"All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?\n","in_progress":"*In Progress*","ending":"*Ending*","starting":"*Starting, please wait*","end_concurrent_labs":"Sorry, you can only run one lab at a time. To start this lab, please confirm that you want all of your existing labs to end.\n","copied":"Copied","no_resource":"Error retrieving resource.","no_support":"No Support","mac_press":"Press ⌘-C to copy","thanks_review":"Thanks for reviewing this lab.","windows_press":"Press Ctrl-C to copy","days":"days"} );
  ql.labRun.init();
  ql.initHeader();
  ql.navigation.init();
  ql.navPanel.init();
  ql.navigation.init();
  
  });
</script>

</body>
</html>

