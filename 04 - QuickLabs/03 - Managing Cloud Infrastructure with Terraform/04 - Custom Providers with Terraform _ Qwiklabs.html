
<!DOCTYPE html>
<html lang='en'>
<head>
<title>Custom Providers with Terraform | Qwiklabs</title>
<script>
//<![CDATA[
window.gon={};gon.current_user={"firstname":"DANIEL","lastname":"ENRIQUE SANDOVAL SANCHEZ","fullname":"DANIEL ENRIQUE SANDOVAL SANCHEZ","company":"Coursera","email":"desandovals@liverpool.com.mx","origin":"googlecoursera-run, lti-coursera","subscriptions":0,"id":"40414ff5fc280f833d9acca966912f93","qlCreatedAt":"2020-11-17 20:45:59 UTC","optIn":null,"current_organization_id":null,"current_organization_role":null};gon.segment="j4Im8pqIko0Lxq4wVVZWMPMM0EroHUvb";gon.deployment="run";gon.content={"type":"Lab","id":1014,"name":"Custom Providers with Terraform"};
//]]>
</script>
<script>
  dataLayer = [
    {user: gon.current_user},
    {content: gon.content}
  ];
</script>
<script>
  (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer',"GTM-TQR88QK");
</script>
<script>
  EVENT_SOURCE_BASE_URL = "https://run.qwiklabs.com/nchan-sub?id=";
</script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/polyfills/webcomponents-loader-408088dc333247a761de5f2b2a4ba1cabd2bc36579f83ba92a559eb3682a9b77.js"></script>
<script src="https://cdn.qwiklabs.com/assets/vendor-45d462772c30000424907184f70c7157e95fb6227698d1671c5051818a6f60d8.js"></script>
<script src="https://cdn.qwiklabs.com/assets/application-034d6698d9e8e4069d310e418a7827442046e71025a0e336e0896055be8a1153.js"></script>
<script src="https://cdn.qwiklabs.com/assets/hallofmirrors/hallofmirrors-b1177b2da0d0a4d1b239b0364e70f5a598873a2b8fb44c288c9428709123506c.js"></script>
<!--[if lt IE 9]>
<script src='http://html5shim.googlecode.com/svn/trunk/html5.js' type='text/javascript'></script>
<![endif]-->
<!--[endif]>  <![endif]-->
<script type='application/ld+json'>
{
  "@context": "http://schema.org",
  "@type": "WebSite",
  "url": "https://www.qwiklabs.com/",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://www.qwiklabs.com/catalog?keywords={search_term_string}",
    "query-input": "required name=search_term_string"
  }
}
</script>


<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="NreWiupld2j0F9LQkLz53W1ig0s8RxAzqRGCDQI5dd2mOYG7yo5hNRbfvd8y1ydO7gEyTUflzjqx9J3lA5Ul6Q==" />
<meta content='width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0' name='viewport'>
<meta content='1rRsY0INj8RvwB5EF5pwdxt2A2P9aDgAlsICaJ0d5w0' name='google-site-verification'>
<meta content='#3681E4' property='msapplication-TileColor'>
<meta content='/favicon-144.png' property='msapplication-TileImage'>
<meta content='[{&quot;id&quot;:&quot;recaptcha_experiment&quot;,&quot;optimize_id&quot;:&quot;dpViOcLkT3qS4TvL2mRojA&quot;,&quot;title&quot;:&quot;No Recaptcha shown for trusted users&quot;,&quot;variant_index&quot;:0,&quot;variant&quot;:&quot;original&quot;}]' name='active-experiments'>
<meta content='{&quot;userId&quot;:3894861}' name='help-api-product-data'>
<meta content='In Terraform, a Provider is the logical abstraction of an upstream API. This lab will show you how to build a custom provider for Terraform.' name='description'>
<meta content='Qwiklabs' name='author'>
<meta content='Custom Providers with Terraform | Qwiklabs' property='og:title'>
<meta content='website' property='og:type'>
<meta content='/favicon-144.png' property='og:image'>
<meta content='Qwiklabs' property='og:site_name'>
<meta content='In Terraform, a Provider is the logical abstraction of an upstream API. This lab will show you how to build a custom provider for Terraform.' property='og:description'>
<meta content='/qwiklabs_logo_900x887.png' property='og:logo' size='900x887'>
<meta content='/qwiklabs_logo_994x187.png' property='og:logo' size='994x187'>


<link href='/favicon-32.png' rel='shortcut icon'>
<link color='#3681E4' href='/favicon-svg.svg' rel='mask-icon'>
<link href='/favicon-180.png' rel='apple-touch-icon-precomposed'>



<link rel="stylesheet" media="screen" href="https://fonts.googleapis.com/css?family=Oswald:400|Roboto+Mono:400,700|Roboto:300,400,500,700|Google+Sans:300,400,500,700|Google+Sans+Display:400|Material+Icons|Google+Material+Icons" />


<link rel="stylesheet" media="all" href="https://cdn.qwiklabs.com/assets/application-3b0f6c441394eebd52ff10f04fb2923fdb7b1b4fec780e7fa8ef67f5dd2ef411.css" />



</head>
<body class='lab-show l-full no-nav application-new focuses focuses-show lab-show l-full no-nav '>
<noscript>
<iframe height='0' src='https://www.googletagmanager.com/ns.html?id=GTM-TQR88QK' style='display:none;visibility:hidden;' width='0'></iframe>
</noscript>
<span class='hidden' id='flash-sibling-before'></span>

<div class='header-container light-theme'>
<div class='header'>
<ql-icon-button class='js-nav-toggle header__nav-panel-button l-mrm'>menu</ql-icon-button>
<div class='header__title'>
<ql-icon-button label="Back" href="https://www.qwiklabs.com/quests/44" id="678de2469d7e1fd7" target="_self">arrow_back</ql-icon-button><div class="mdl-tooltip" data-mdl-for="678de2469d7e1fd7">Back</div>

<h1 class='headline-5'>
Custom Providers with Terraform
</h1>
</div>
<div class='header__actions'>
<ql-icon-button class='header__button--search js-header-search-bar-button'>search</ql-icon-button>
<ql-icon-button id='share_1014'>share</ql-icon-button>
<ql-menu for='share_1014'>
<ql-menu-item>
<a data-analytics-action="Shared to LinkedIn." data-analytics-category="Lab" data-analytics-label="Custom Providers with Terraform" target="_blank" href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fwww.qwiklabs.com%2Fcatalog_lab%2F1014%3Futm_medium%3Dsocial%26utm_source%3Dlinkedin%26utm_campaign%3Dql-social-share"><ql-icon class='l-mrs'>post_linkedin</ql-icon>
LinkedIn
</a>
</ql-menu-item>
<ql-menu-item>
<a data-analytics-action="Shared to Twitter." data-analytics-category="Lab" data-analytics-label="Custom Providers with Terraform" target="_blank" href="https://twitter.com/intent/tweet?text=Learn%20cloud%20tech%20through%20hands-on%20training%20on%20%23Qwiklabs%21&amp;url=https%3A%2F%2Fwww.qwiklabs.com%2Fcatalog_lab%2F1014%3Futm_medium%3Dsocial%26utm_source%3Dtwitter%26utm_campaign%3Dql-social-share&amp;hashtags="><ql-icon class='l-mrs'>post_twitter</ql-icon>
Twitter
</a>
</ql-menu-item>
<ql-menu-item>
<a data-analytics-action="Shared to Facebook." data-analytics-category="Lab" data-analytics-label="Custom Providers with Terraform" target="_blank" href="https://facebook.com/sharer.php?display=popup&amp;u=https%3A%2F%2Fwww.qwiklabs.com%2Fcatalog_lab%2F1014%3Futm_medium%3Dsocial%26utm_source%3Dfacebook%26utm_campaign%3Dql-social-share"><ql-icon class='l-mrs'>post_facebook</ql-icon>
Facebook
</a>
</ql-menu-item>
<ql-menu-item>
<ql-copyable-input label='Share Link' value='https://www.qwiklabs.com/catalog_lab/1014'></ql-copyable-input>
</ql-menu-item>
</ql-menu>

<a class="icon-button js-favorite-button favorite-button" id="CatalogItem-1204-favorite-button" data-type="CatalogItem" data-id="1204" data-name="Custom Providers with Terraform" href="/favorite.json?item_id=1204&amp;item_type=CatalogItem"><ql-icon>favorite_border</ql-icon>
</a><div class='mdl-tooltip js-tooltip' for='CatalogItem-1204-favorite-button'>
Add to favorites
</div>



<ql-icon-button id='control-panel-target' style='display: none;'>
dashboard
</ql-icon-button>
<ql-menu for='control-panel-target' id='control-panel-menu'></ql-menu>

<ql-icon-button id='help-menu-button'>help</ql-icon-button>
<div class='mdl-tooltip js-tooltip' data-mdl-for='help-menu-button'>
Help
</div>
<ql-menu for='help-menu-button' id='help-menu'>
<ql-menu-item>
<ql-help context='lab' data-analytics-action='opened_help' data-analytics-label='lab' productdata='{&quot;userId&quot;:3894861}'>
Help Center
</ql-help>
</ql-menu-item>
<ql-menu-item>
<a target="_blank" class="ql-body-1" href="https://support.google.com/qwiklabs/contact/contact_us">Email support</a>
</ql-menu-item>
</ql-menu>

<ql-icon-button id='language'>language</ql-icon-button>
<div class='mdl-menu mdl-menu__bottom-right mdl-js-menu elevation-3' for='language'>
<a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ar" href="/focuses/1204?locale=ar&amp;parent=catalog">العربية‬‎
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="de" href="/focuses/1204?locale=de&amp;parent=catalog">Deutsch
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="en" href="/focuses/1204?locale=en&amp;parent=catalog">English
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="es" href="/focuses/1204?locale=es&amp;parent=catalog">español (Latinoamérica)
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="fr" href="/focuses/1204?locale=fr&amp;parent=catalog">français
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="id" href="/focuses/1204?locale=id&amp;parent=catalog">bahasa Indonesia
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="it" href="/focuses/1204?locale=it&amp;parent=catalog">Italiano
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ja" href="/focuses/1204?locale=ja&amp;parent=catalog">日本語
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ko" href="/focuses/1204?locale=ko&amp;parent=catalog">한국어
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="pl" href="/focuses/1204?locale=pl&amp;parent=catalog">Polski
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="pt_BR" href="/focuses/1204?locale=pt_BR&amp;parent=catalog">português (Brasil)
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="pt_PT" href="/focuses/1204?locale=pt_PT&amp;parent=catalog">português (Portugal)
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="ru" href="/focuses/1204?locale=ru&amp;parent=catalog">русский
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="tr" href="/focuses/1204?locale=tr&amp;parent=catalog">Türkçe
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="zh" href="/focuses/1204?locale=zh&amp;parent=catalog">简体中文
</a><a class="mdl-menu__item locale-link" data-analytics-action="changed_locale" data-analytics-label="zh_TW" href="/focuses/1204?locale=zh_TW&amp;parent=catalog">繁體中文
</a></div>
<button class='icon-button' id='my_account'>
<ql-avatar src='https://lh3.googleusercontent.com/a-/AOh14Gh6Bmcr7vfcCi5iPAH2qDeJgSaD6RLv1Muiv9mceA=s320-c'></ql-avatar>
</button>
<ql-menu for='my_account' open>
<div class='my-account-menu'>
<ql-avatar class='l-mtl l-mbl' size='120' src='https://lh3.googleusercontent.com/a-/AOh14Gh6Bmcr7vfcCi5iPAH2qDeJgSaD6RLv1Muiv9mceA=s320-c'></ql-avatar>
<div class='my-account-menu__user-info l-mbl'>
<h4 class='ql-subhead-1'>DANIEL ENRIQUE SANDOVAL SANCHEZ</h4>
<p class='ql-body-2 text--light'>desandovals@liverpool.com.mx</p>
<p class='ql-body-2 text--light'>
</p>
<a class="text--green ql-subhead-2" href="/my_account/payments"><ql-chip positive>
1896 Credits
</ql-chip>
</a></div>
<div class='buttons l-mbl'>
<a class="button button--hairline l-mrm" id="profile" href="/public_profiles/7a1e8d39-fa01-4103-ac38-c0184ccdbd0c">Profile</a>
<a class="button button--hairline" id="settings" href="/my_account/profile">Settings</a>
</div>
<hr>
<ql-button data-analytics-action='clicked_sign_out' href='/users/sign_out' method='delete'>
Sign Out
</ql-button>
<div class='privacy l-mtl'>
<a class="ql-caption text--light" href="/privacy_policy">Privacy</a>
<span class='ql-caption text--light l-mls l-mrs'>&middot;</span>
<a class="ql-caption text--light" href="/terms_of_service">Terms</a>
</div>
</div>
</ql-menu>

</div>
</div>
<div class='header__search-bar js-header-search-bar'>
<form class="js-search-form-mobile" onsubmit="ql.searchFilter(); return false;" action="/searches/elasticsearch" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="WpVnYEHwfE4slGYBPTPWC4IFNRu0GC+t7Xk2ZPW+VODKG3BRYRtqE85cCQ6fWAiYAWaEHc+68aT1nCmM9BIE1A==" />
<input type="text" name="keywords" id="keywords" placeholder="Search" maxlength="255" aria-label="catalog search bar" />
</form>

<ql-icon-button class='js-close-search-bar'>close</ql-icon-button>
</div>
</div>

<nav class='nav-bar'>
<a class="nav-bar__item js-navigation-button" href="/"><ql-icon class='nav-bar__item__icon'>
home
</ql-icon>
<span class='nav-bar__item__label'>
Home
</span>
</a>
<a class="nav-bar__item js-navigation-button  active" aria-current="page" href="/catalog"><ql-icon class='nav-bar__item__icon'>
school
</ql-icon>
<span class='nav-bar__item__label'>
Catalog
</span>
</a>
<a class="nav-bar__item js-navigation-button" href="/my_learning"><ql-icon class='nav-bar__item__icon'>
event_note
</ql-icon>
<span class='nav-bar__item__label'>
My Learning
</span>
</a>
</nav>

<nav class='nav-panel js-nav-panel'>
<div class='nav-panel__logo'>
<div class='logo logo--blue'></div>
</div>
<a title="Home" tabindex="-1" class="nav-panel__item js-navigation-button" href="/"><ql-icon class='nav-panel__item__icon'>
home
</ql-icon>
<div class='nav-panel__item__label'>
Home
</div>
</a>
<a title="Catalog" tabindex="-1" class="nav-panel__item js-navigation-button active" aria-current="page" href="/catalog"><ql-icon class='nav-panel__item__icon'>
school
</ql-icon>
<div class='nav-panel__item__label'>
Catalog
</div>
</a>
<a title="My Learning" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_learning"><ql-icon class='nav-panel__item__icon'>
event_note
</ql-icon>
<div class='nav-panel__item__label'>
My Learning
</div>
</a>
<div class='nav-panel__spacer'></div>
<a title="Profile" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/profile"><ql-icon class='nav-panel__item__icon'>
account_circle
</ql-icon>
<div class='nav-panel__item__label'>
Profile
</div>
</a>
<a title="Credits &amp; Subscriptions" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/credits"><ql-icon class='nav-panel__item__icon'>
money
</ql-icon>
<div class='nav-panel__item__label'>
Credits &amp; Subscriptions
</div>
</a>
<a title="Security" tabindex="-1" class="nav-panel__item js-navigation-button" href="/my_account/security"><ql-icon class='nav-panel__item__icon'>
security
</ql-icon>
<div class='nav-panel__item__label'>
Security
</div>
</a>
<div class='nav-panel__spacer'></div>
<a class="nav-panel__item" tabindex="-1" href="#"><ql-help>
<div class='nav-panel__help-item'>
<ql-icon class='nav-panel__item__icon'>help</ql-icon>
<div class='nav-panel__item__label'>
Help
</div>
</div>
</ql-help>
</a><div class='nav-panel__small-links'>
<a tabindex="-1" href="/privacy_policy">Privacy</a>
<a tabindex="-1" href="/terms_of_service">Terms</a>
</div>
</nav>
<div class='nav-panel__overlay js-nav-toggle'></div>

<main class='js-main'>
<div class='l-main-wrapper' id='main-wrapper'>







<ql-drawer-container class='js-lab-state' data-analytics-payload='{&quot;label&quot;:&quot;Custom Providers with Terraform&quot;,&quot;lab_name&quot;:&quot;Custom Providers with Terraform&quot;,&quot;classroom_name&quot;:null,&quot;deployment&quot;:&quot;run&quot;}' data-focus-id='1204' data-lab-billing-limit='0.0' data-lab-duration='4500' data-parent='catalog' data-payment-required data-recaptcha-enabled id='lab-container'>
<ql-drawer id='terminal-drawer' slot='drawer' style='width: calc(100% - 480px)'>
<iframe allow='clipboard-read' class='terminal' id='embedded-resource'></iframe>
</ql-drawer>
<ql-drawer-content class='js-lab-wrapper' id='lab-content' slot='drawer-content'>
<ql-drawer-container id='lab-content-container'>
<ql-drawer id='control-panel-drawer' open slot='drawer' width='320'>
<ql-lab-control-panel class='ql-lab-control-panel__max-height control-panel js-lab-control-panel' connectionFiles='[]' labControlButton='{&quot;disabled&quot;:false,&quot;pending&quot;:false,&quot;running&quot;:false}' labDetails='[]' labTimer='{&quot;ticking&quot;:false,&quot;secondsRemaining&quot;:4500}' studentResources='[]'>
<script src="https://www.recaptcha.net/recaptcha/api.js?render=6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr"   ></script>
        <script>
          // Define function so that we can call it again later if we need to reset it
          // This executes reCAPTCHA and then calls our callback.
          function executeRecaptchaForStartLab() {
            grecaptcha.ready(function() {
              grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}).then(function(token) {
                setInputWithRecaptchaResponseTokenForStartLab('g-recaptcha-response-data-start-lab', token)
              });
            });
          };
          // Invoke immediately
          executeRecaptchaForStartLab()

          // Async variant so you can await this function from another async function (no need for
          // an explicit callback function then!)
          // Returns a Promise that resolves with the response token.
          async function executeRecaptchaForStartLabAsync() {
            return new Promise((resolve, reject) => {
              grecaptcha.ready(async function() {
                resolve(await grecaptcha.execute('6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr', {action: 'start_lab'}))
              });
            })
          };

                    var setInputWithRecaptchaResponseTokenForStartLab = function(id, token) {
            var element = document.getElementById(id);
            element.value = token;
          }

        </script>
<input type="hidden" name="g-recaptcha-response-data[start_lab]" id="g-recaptcha-response-data-start-lab" data-sitekey="6LeVI8IUAAAAAJNdox5eTkYrw9SbvhZ1TFyv3iHr" class="g-recaptcha g-recaptcha-response "/>

<div class='hidden' id='recaptcha-v2-start-lab' slot='recaptcha'>
<script src="https://www.recaptcha.net/recaptcha/api.js" async defer ></script>
<div data-sitekey="6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV" data-callback="recaptchaComplete" data-expired-callback="expireV2Token" class="g-recaptcha "></div>
          <noscript>
            <div>
              <div style="width: 302px; height: 422px; position: relative;">
                <div style="width: 302px; height: 422px; position: absolute;">
                  <iframe
                    src="https://www.recaptcha.net/recaptcha/api/fallback?k=6LeOI8IUAAAAAPkHlMAE9NReCD_1WD81iYlBlCnV"
                    name="ReCAPTCHA"
                    style="width: 302px; height: 422px; border-style: none; border: 0; overflow: hidden;">
                  </iframe>
                </div>
              </div>
              <div style="width: 300px; height: 60px; border-style: none;
                bottom: 12px; left: 25px; margin: 0px; padding: 0px; right: 25px;
                background: #f9f9f9; border: 1px solid #c1c1c1; border-radius: 3px;">
                <textarea id="g-recaptcha-response" name="g-recaptcha-response"
                  class="g-recaptcha-response"
                  style="width: 250px; height: 40px; border: 1px solid #c1c1c1;
                  margin: 10px 25px; padding: 0px; resize: none;">
                </textarea>
              </div>
            </div>
          </noscript>

</div>
</ql-lab-control-panel>
</ql-drawer>
<ql-drawer-content id='lab-instructions' slot='drawer-content'>
<div class='alert alert--fake js-alert'>
<p class='alert__message js-alert-message'></p>
<a class='alert__close js-alert-close'>
<i class='fa fa-times'></i>
</a>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='js-lab-content lab-content__renderable-instructions'>
<div class='lab-preamble'>
<h1 class='lab-preamble__title'>
Custom Providers with Terraform
</h1>
<div class='lab-preamble__details subtitle-headline-1'>
<span>1 hour 15 minutes</span>
<span>9 Credits</span>
<div class='lab__rating'>
<a href="/focuses/1204/reviews?parent=catalog"><div class='rateit' data-rateit-readonly='true' data-rateit-value='4.0544'></div>

</a><a data-target='#lab-review-modal' data-toggle='modal'>
Rate Lab
</a>
</div>
</div>
</div>

<div class='js-markdown-instructions markdown-lab-instructions' id='markdown-lab-instructions'>



<h2 id="step1">GSP208</h2>
<p><img alt="Google Cloud Self-Paced Labs" src="https://cdn.qwiklabs.com/GMOHykaqmlTHiqEeQXTySaMXYPHeIvaqa2qHEzw6Occ%3D"></p>

<h2 id="step2">Overview</h2>
<p>In Terraform, a Provider is the logical abstraction of an upstream API. In this lab, you will learn how to build a custom provider for Terraform. Terraform supports a plugin model, and all providers are actually plugins. Plugins are distributed as Go binaries. Although technically possible to write a plugin in another language, almost all Terraform plugins are written in <a href="https://golang.org/" target="_blank">Go</a>.</p>
<h3>Objectives</h3>
<p>In this lab, you will build a custom provider for Terraform by:</p>
<ul>
<li>Building the plugin</li>
<li>Defining resources</li>
<li>Invoking the provider</li>
<li>Learning about error handling and partial state</li>
<li>Implementing the destroy and read functions</li>
</ul>
<h3>Prerequisites</h3>
<p>For this lab, you should have experience with the following:</p>
<ul>
<li>
<p>Familarity with Linux editor like <code>nano</code>, <code>vi</code> etc.</p>
</li>
<li>
<p>Familarity with <code>Go</code> programming language.</p>
</li>
</ul>
<h2 id="step3">Setup and Requirements</h2>
<h4>Before you click the Start Lab button</h4>
<p>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click <strong>Start Lab</strong>, shows how long Google Cloud resources will be made available to you.</p>
<p>This Qwiklabs hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</p>
<h4>What you need</h4>
<p>To complete this lab, you need:</p>
<ul>
<li>Access to a standard internet browser (Chrome browser recommended).</li>
<li>Time to complete the lab.</li>
</ul>
<p><strong>Note:</strong> If you already have your own personal Google Cloud account or project, do not use it for this lab.</p>
<p><strong>Note:</strong> If you are using a Pixelbook, open an Incognito window to run this lab.</p>

<h4>How to start your lab and sign in to the Google Cloud Console</h4>
<ol>
<li>
<p>Click the <strong>Start Lab</strong> button. If you need to pay for the lab, a pop-up opens for you to select your payment method.
On the left is a panel populated with the temporary credentials that you must use for this lab.</p>
<p><img alt="Open Google Console" src="https://cdn.qwiklabs.com/%2FtHp4GI5VSDyTtdqi3qDFtevuY014F88%2BFow%2FadnRgE%3D"></p>
</li>
<li>
<p>Copy the username, and then click <strong>Open Google Console</strong>.
The lab spins up resources, and then opens another tab that shows the <strong>Sign in</strong> page.</p>
<p><img alt="Sign in" src="https://cdn.qwiklabs.com/VkUIAFY2xX3zoHgmWqYKccRLwFrR4BfARLd5ojmlbhs%3D"></p>
<p><strong><em>Tip:</em></strong> Open the tabs in separate windows, side-by-side.</p>
<aside>
 If you see the <strong>Choose an account</strong> page, click <strong>Use Another Account</strong>.
<img alt="Choose an account" src="https://cdn.qwiklabs.com/eQ6xPnPn13GjiJP3RWlHWwiMjhooHxTNvzfg1AL2WPw%3D">
</aside>
</li>
<li>
<p>In the <strong>Sign in</strong> page, paste the username that you copied from the Connection Details panel. Then copy and paste the password.</p>
<p><strong><em>Important:</em></strong> You must use the credentials from the Connection Details panel. Do not use your Qwiklabs credentials. If you have your own Google Cloud account, do not use it for this lab (avoids incurring charges).</p>
</li>
<li>
<p>Click through the subsequent pages:</p>
<ul>
<li>Accept the terms and conditions.</li>
<li>Do not add recovery options or two-factor authentication (because this is a temporary account).</li>
<li>Do not sign up for free trials.</li>
</ul>
</li>
</ol>
<p>After a few moments, the Cloud Console opens in this tab.</p>
<aside>
<strong>Note:</strong> You can view the menu with a list of Google Cloud Products and Services by clicking the <strong>Navigation menu</strong> at the top-left.
<img alt="Cloud Console Menu" src="https://cdn.qwiklabs.com/9vT7xPlxoNP%2FPsK0J8j0ZPFB4HnnpaIJVCDByaBrSHg%3D">
</aside>

<h3>Activate Cloud Shell</h3>
<p>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</p>
<p>In the Cloud Console, in the top right toolbar, click the <strong>Activate Cloud Shell</strong> button.</p>
<p><img alt="Cloud Shell icon" src="https://cdn.qwiklabs.com/vdY5e%2Fan9ZGXw5a%2FZMb1agpXhRGozsOadHURcR8thAQ%3D"></p>
<p>Click <strong>Continue</strong>.</p>
<p><img alt="cloudshell_continue.png" src="https://cdn.qwiklabs.com/lr3PBRjWIrJ%2BMQnE8kCkOnRQQVgJnWSg4UWk16f0s%2FA%3D"></p>
<p>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your <em>PROJECT_ID</em>. For example:</p>
<p><img alt="Cloud Shell Terminal" src="https://cdn.qwiklabs.com/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D"></p>
<p><code>gcloud</code> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</p>
<p>You can list the active account name with this command:</p>
<pre><code>gcloud auth list&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-output prettyprint">Credentialed accounts:&#x000A; - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)&#x000A;</code></pre>
<p>(Example output)</p>
<pre><code class="language-Output prettyprint">Credentialed accounts:&#x000A; - google1623327_student@qwiklabs.net&#x000A;</code></pre>
<p>You can list the project ID with this command:</p>
<pre><code>gcloud config list project&#x000A;</code></pre>
<p>(Output)</p>
<pre><code class="language-output prettyprint">[core]&#x000A;project = &lt;project_ID&gt;&#x000A;</code></pre>
<p>(Example output)</p>
<pre><code class="language-Output prettyprint">[core]&#x000A;project = qwiklabs-gcp-44776a13dea667a6&#x000A;</code></pre>
<aside>
  For full documentation of <code>gcloud</code> see the <a href="https://cloud.google.com/sdk/gcloud" target="_blank">gcloud command-line tool overview</a>.

</aside>

<h2 id="step4">Requirement of Custom Providers</h2>
<p>Some examples of when to author a custom Terraform provider:</p>
<ul>
<li>
<p>An internal private cloud whose functionality is either proprietary or would not benefit the open source community.</p>
</li>
<li>
<p>A "work in progress" provider being tested locally before contributing back.</p>
</li>
<li>
<p>Extensions of an existing provider.</p>
</li>
</ul>
<h2 id="step5">The provider schema</h2>
<ol>
<li>
<p>In Cloud shell, create a file named <code>provider.go</code>. This is the root of the provider.</p>
</li>
</ol>
<pre><code>touch provider.go&#x000A;</code></pre>
<ol start="2">
<li>
<p>Click the <strong>Open Editor</strong> button on the toolbar of Cloud Shell. (You can switch between Cloud Shell and the code editor by using the <strong>Open Editor</strong> and <strong>Open Terminal</strong> icons as required, or click the <strong>Open in new window</strong> button to leave the Editor open in a separate tab).</p>
</li>
<li>
<p>In the Editor, add the following content to the <code>provider.go</code> file.</p>
</li>
</ol>
<pre><code>package main&#x000A;&#x000A;import (&#x000A;        "github.com/hashicorp/terraform-plugin-sdk/helper/schema"&#x000A;)&#x000A;&#x000A;func Provider() *schema.Provider {&#x000A;        return &amp;schema.Provider{&#x000A;                ResourcesMap: map[string]*schema.Resource{},&#x000A;        }&#x000A;}&#x000A;</code></pre>
<p>The <a href="https://pkg.go.dev/github.com/hashicorp/terraform-plugin-sdk/helper/schema" target="_blank">helper/schema</a> library is part of <a href="https://www.terraform.io/docs/extend/how-terraform-works.html#terraform-core" target="_blank">Terraform Core</a>. It abstracts many of the complexities and ensures consistency between providers. The example above defines an empty provider (there are no resources).</p>
<p>The <code>*schema.Provider</code> type describes the provider's properties including:</p>
<ul>
<li>
<p>the configuration keys it accepts</p>
</li>
<li>
<p>the resources it supports</p>
</li>
<li>
<p>any callbacks to configure</p>
</li>
</ul>
<h2 id="step6">Building the Plugin</h2>
<p>Go requires a <code>main.go</code> file, which is the default executable when the binary is built.</p>
<ol>
<li>
<p>Create a file named <code>main.go</code>.</p>
</li>
</ol>
<pre><code>touch main.go&#x000A;</code></pre>
<ol start="2">
<li>
<p>Since Terraform plugins are distributed as Go binaries, it is important to define this entry-point, which you'll do by adding the following code to the file:</p>
</li>
</ol>
<pre><code>package main&#x000A;&#x000A;import (&#x000A;        "github.com/hashicorp/terraform-plugin-sdk/plugin"&#x000A;        "github.com/hashicorp/terraform-plugin-sdk/terraform"&#x000A;)&#x000A;&#x000A;func main() {&#x000A;        plugin.Serve(&amp;plugin.ServeOpts{&#x000A;                ProviderFunc: func() terraform.ResourceProvider {&#x000A;                        return Provider()&#x000A;                },&#x000A;        })&#x000A;}&#x000A;</code></pre>
<p>This establishes the main function to produce a valid, executable Go binary. The contents of the main function consume Terraform's plugin library. This library deals with all the communication between Terraform core and the plugin.</p>
<ol start="3">
<li>
<p>Create a module for your Terraform Go packages:</p>
</li>
</ol>
<pre><code>go mod init gopath/src/github.com/hashicorp/terraform-plugin-sdk&#x000A;</code></pre>
<ol start="4">
<li>
<p>Download and install Terraform packages and dependencies.</p>
</li>
</ol>
<pre><code>go get github.com/hashicorp/terraform-plugin-sdk/helper/schema&#x000A;go get github.com/hashicorp/terraform-plugin-sdk/plugin&#x000A;go get github.com/hashicorp/terraform-plugin-sdk/terraform&#x000A;</code></pre>
<ol start="5">
<li>
<p>Next, build the plugin using the Go toolchain:</p>
</li>
</ol>
<pre><code>go build -o terraform-provider-example&#x000A;</code></pre>
<p>The output name (-o) is <strong>very important</strong>. Terraform searches for plugins in the format of:</p>
<pre><code>terraform-&lt;TYPE&gt;-&lt;NAME&gt;&#x000A;</code></pre>
<p>In the case above, the plugin is of type <strong>provider</strong> and of name <strong>example</strong>.</p>
<ol start="6">
<li>
<p>List out the contents of the directory.</p>
</li>
</ol>
<pre><code>ls&#x000A;</code></pre>
<ol start="7">
<li>
<p>To verify things are working correctly, execute the binary you just created:</p>
</li>
</ol>
<pre><code>./terraform-provider-example&#x000A;</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code>This binary is a plugin. These are not meant to be executed directly.&#x000A;Please execute the program that consumes these plugins, which will&#x000A;load any plugins automatically&#x000A;</code></pre>
<p>Your file tree should look like this:</p>
<p><img alt="basic_tree.png" src="https://cdn.qwiklabs.com/JgmIcz%2BSSsCOAbxN7u1VQjxNwE113HHfvZFA%2FGujBsw%3D"></p>
<h2 id="step7">Defining Resources</h2>
<p>Terraform providers manage resources. A <em><em>provider</em></em> is an abstraction of an upstream API, and a <em><em>resource</em></em> is a component of that provider. As an example, the Google provider supports <code>google_compute_instance</code> and <code>google_compute_address</code>.</p>
<p>As a general convention, Terraform providers put each resource in their own file, named after the resource, prefixed with <code>resource_</code>.</p>
<ol>
<li>
<p>Create an example_server and name it <code>resource_server.go</code> by convention.</p>
</li>
</ol>
<pre><code>touch resource_server.go&#x000A;</code></pre>
<ol start="2">
<li>
<p>Add the following code to the file:</p>
</li>
</ol>
<pre><code>package main&#x000A;&#x000A;import (&#x000A;        "github.com/hashicorp/terraform-plugin-sdk/helper/schema"&#x000A;)&#x000A;&#x000A;func resourceServer() *schema.Resource {&#x000A;        return &amp;schema.Resource{&#x000A;                Create: resourceServerCreate,&#x000A;                Read:   resourceServerRead,&#x000A;                Update: resourceServerUpdate,&#x000A;                Delete: resourceServerDelete,&#x000A;&#x000A;                Schema: map[string]*schema.Schema{&#x000A;                        "address": &amp;schema.Schema{&#x000A;                                Type:     schema.TypeString,&#x000A;                                Required: true,&#x000A;                        },&#x000A;                },&#x000A;        }&#x000A;}&#x000A;</code></pre>
<p>This uses the <a href="https://pkg.go.dev/github.com/hashicorp/terraform-plugin-sdk/helper/schema#Resource" target="_blank"><code>schema.Resource</code> type</a>. This structure defines the data schema and CRUD operations for the resource. Defining these properties are the only required thing to create a resource.</p>
<p>The schema above defines one element, <strong>address</strong>, which is a required string. Terraform's schema automatically enforces validation and type casting.</p>
<p>Next there are four <strong>fields</strong> defined - <code>Create</code>, <code>Read</code>, <code>Update</code>, and <code>Delete</code>. The Create, Read, and Delete functions are required for a resource to be functional. There are other functions, but these are the only required ones. Terraform itself handles which function to call and with what data. Based on the schema and current state of the resource, Terraform can determine whether it needs to create a new resource, update an existing one, or destroy.</p>
<p>Each of the four struct fields point to a function. While it is technically possible to inline all functions in the resource schema, best practice dictates pulling each function into its own method. This optimizes for both testing and readability. You will fill in those stubs now, paying close attention to method signatures.</p>
<ol start="3">
<li>
<p>Update the <code>resource_server.go</code> file and add the following contents at the end of the file.</p>
</li>
</ol>
<pre><code>func resourceServerCreate(d *schema.ResourceData, m interface{}) error {&#x000A;        return nil&#x000A;}&#x000A;&#x000A;func resourceServerRead(d *schema.ResourceData, m interface{}) error {&#x000A;        return nil&#x000A;}&#x000A;&#x000A;func resourceServerUpdate(d *schema.ResourceData, m interface{}) error {&#x000A;        return nil&#x000A;}&#x000A;&#x000A;func resourceServerDelete(d *schema.ResourceData, m interface{}) error {&#x000A;        return nil&#x000A;}&#x000A;</code></pre>
<ol start="4">
<li>
<p>Lastly, update the provider schema in <code>provider.go</code> to register the new example_server resource.</p>
</li>
</ol>
<pre><code>func Provider() *schema.Provider {&#x000A;        return &amp;schema.Provider{&#x000A;                ResourcesMap: map[string]*schema.Resource{&#x000A;                        "example_server": resourceServer(),&#x000A;                },&#x000A;        }&#x000A;}&#x000A;</code></pre>
<ol start="5">
<li>
<p>Build and test the plugin. Everything should compile as-is, although all operations are a no-op.</p>
</li>
</ol>
<pre><code>go build -o terraform-provider-example&#x000A;</code></pre>
<pre><code>./terraform-provider-example&#x000A;</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code>This binary is a plugin. These are not meant to be executed directly.&#x000A;Please execute the program that consumes these plugins, which will&#x000A;load any plugins automatically&#x000A;</code></pre>
<p>The layout now looks like this:</p>
<p><img alt="updated_layout.png" src="https://cdn.qwiklabs.com/0pmZPDWBZyO9kCBSjNUNUTL5LNLk%2BFNhpK40Gta9mSw%3D"></p>
<h2 id="step8">Move the Provider to Plugins Directory</h2>
<p>With Terraform 0.13+, you must specify all required providers and their respective source in your Terraform configuration. A provider source string is comprised of <strong>hostname</strong>/<strong>namespace</strong>/<strong>name</strong>.</p>
<p>When you run <code>terraform init</code>, Terraform will attempt to download the provider from the Terraform Registry.</p>
<p>If Terraform can't download the provider from the Terraform Registry (for example if the provider is local, or because of firewall restrictions), you can specify the installation method configuration explicitly. Otherwise, Terraform will implicitly attempt to find the provider locally in the appropriate subdirectory within the user plugins directory, <code>~/.terraform.d/plugins/${host_name}/${namespace}/${type}/${version}/${target}</code> or <code>%APPDATA%\terraform.d\plugins\${host_name}/${namespace}/${type}/${version}/${target}</code>.</p>
<p>In order to use the local example provider you built, you'll move it into the proper subdirectory and then, later in the lab, point to that location in a <code>main.tf</code> file.</p>
<p>First, create the directory:</p>
<pre><code>mkdir -p ~/.terraform.d/plugins/example.com/qwiklabs/example/1.0.0/linux_amd64&#x000A;</code></pre>
<p>Then, copy the <code>terraform-provider-example</code> binary into that location:</p>
<pre><code>cp terraform-provider-example ~/.terraform.d/plugins/example.com/qwiklabs/example/1.0.0/linux_amd64&#x000A;</code></pre>
<h2 id="step9">Invoking the Provider</h2>
<p>Previous sections showed running the provider directly via the shell, which outputs a warning message like:</p>
<pre><code>This binary is a plugin. These are not meant to be executed directly.&#x000A;Please execute the program that consumes these plugins, which will&#x000A;load any plugins automatically&#x000A;</code></pre>
<ol>
<li>
<p>Terraform plugins should be executed by Terraform directly. To test this, create a <code>main.tf</code> in the working directory (the same place where the plugin exists).</p>
</li>
</ol>
<pre><code>touch main.tf&#x000A;</code></pre>
<ol start="2">
<li>
<p>Next, add the following content to the file.</p>
</li>
</ol>
<pre><code># This is required for Terraform 0.13+&#x000A;terraform {&#x000A;  required_providers {&#x000A;    example = {&#x000A;      version = "~&gt; 1.0.0"&#x000A;      source  = "example.com/qwiklabs/example"&#x000A;    }&#x000A;  }&#x000A;}&#x000A;&#x000A;resource "example_server" "my-server" {}&#x000A;</code></pre>
<p>Take note of the source and version included in the <code>required_providers</code> block. When the init command is executed, terraform will search for the example provider in the plugins folder with these specifications.</p>
<ol start="3">
<li>
<p>Run <code>terraform init</code> to discover the newly compiled Provider:</p>
</li>
</ol>
<pre><code>terraform init&#x000A;</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code>Initializing provider plugins...&#x000A;&#x000A;Terraform has been successfully initialized!&#x000A;&#x000A;You may now begin working with Terraform. Try running "terraform plan" to see&#x000A;any changes that are required for your infrastructure. All Terraform commands&#x000A;should now work.&#x000A;&#x000A;If you ever set or change modules or backend configuration for Terraform,&#x000A;rerun this command to reinitialize your working directory. If you forget, other&#x000A;commands will detect it and remind you to do so if necessary.&#x000A;</code></pre>
<ol start="4">
<li>
<p>Now execute <code>terraform plan</code>:</p>
</li>
</ol>
<pre><code>terraform plan&#x000A;</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code>1 error(s) occurred:&#x000A;&#x000A;* example_server.my-server: "address": required field is not set&#x000A;</code></pre>
<p>This validates Terraform is correctly delegating work to your plugin and that your validation is working as intended.</p>
<ol start="5">
<li>
<p>Fix the validation error by adding an <code>address</code> field to the <code>main.tf</code> resource:</p>
</li>
</ol>
<pre><code>resource "example_server" "my-server" {&#x000A;  address = "1.2.3.4"&#x000A;}&#x000A;</code></pre>
<ol start="6">
<li>
<p>Execute <code>terraform plan</code> to verify the validation is passing:</p>
</li>
</ol>
<pre><code>terraform plan&#x000A;</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code>Refreshing Terraform state in-memory prior to plan...&#x000A;The refreshed state will be used to calculate this plan, but will not be&#x000A;persisted to local or remote state storage.&#x000A;&#x000A;&#x000A;------------------------------------------------------------------------&#x000A;&#x000A;An execution plan has been generated and is shown below.&#x000A;Resource actions are indicated with the following symbols:&#x000A;  + create&#x000A;&#x000A;Terraform will perform the following actions:&#x000A;&#x000A;  + example_server.my-server&#x000A;      id:      &lt;computed&gt;&#x000A;      address: "1.2.3.4"&#x000A;&#x000A;&#x000A;Plan: 1 to add, 0 to change, 0 to destroy.&#x000A;&#x000A;------------------------------------------------------------------------&#x000A;</code></pre>
<ol start="7">
<li>
<p>You can optionally run <code>terraform apply</code>, but it will be a no-op because all of the resource options currently take no action.</p>
</li>
</ol>
<h2 id="step10">Implement Create</h2>
<ol>
<li>
<p>Navigate to the <code>resource_server.go</code> file. Implement the <code>Create</code> functionality by making the following update:</p>
</li>
</ol>
<pre><code>func resourceServerCreate(d *schema.ResourceData, m interface{}) error {&#x000A;        address := d.Get("address").(string)&#x000A;        d.SetId(address)&#x000A;        return nil&#x000A;}&#x000A;</code></pre>
<p>This uses the <a href="https://pkg.go.dev/github.com/hashicorp/terraform-plugin-sdk/helper/schema#ResourceData" target="_blank">schema.ResourceData</a> API to get the value of <strong>address</strong> provided by the user in the Terraform configuration. Due to the way Go works, we have to typecast it to string. This is a safe operation, however, since our schema guarantees it will be a string type.</p>
<p>Next, it uses <strong>SetId</strong>, a built-in function, to set the ID of the resource to the address. The existence of a non-blank ID is what tells Terraform that a resource was created. This ID can be any string value, but should be a value that can be used to read the resource again.</p>
<p>Finally, you must recompile the binary and instruct Terraform to reinitialize it by rerunning <code>terraform init</code>. This is only necessary because you have modified the code and recompiled the binary and it no longer matches an internal hash Terraform uses to ensure the same binaries are used for each operation.</p>
<ol start="2">
<li>
<p>Recompile and reinitialize the Provider:</p>
</li>
</ol>
<pre><code>go build -o terraform-provider-example&#x000A;</code></pre>
<ol start="3">
<li>
<p>Move your provider into the plugins subdirectory with a new version:</p>
</li>
</ol>
<pre><code>mkdir -p ~/.terraform.d/plugins/example.com/qwiklabs/example/1.0.1/linux_amd64&#x000A;cp terraform-provider-example ~/.terraform.d/plugins/example.com/qwiklabs/example/1.0.1/linux_amd64&#x000A;</code></pre>
<ol start="4">
<li>
<p>Update the <code>required_providers</code> block in <code>main.tf</code> to use new <strong>1.0.1</strong> version:</p>
</li>
</ol>
<pre><code># This is required for Terraform 0.13+&#x000A;terraform {&#x000A;  required_providers {&#x000A;    example = {&#x000A;      version = "~&gt; 1.0.1"&#x000A;      source  = "example.com/qwiklabs/example"&#x000A;    }&#x000A;  }&#x000A;}&#x000A;</code></pre>
<ol start="5">
<li>
<p>Reinitialize Terraform:</p>
</li>
</ol>
<pre><code>terraform init -upgrade&#x000A;</code></pre>
<ol start="6">
<li>Run <code>terraform plan</code>:</li>
</ol>
<pre><code>terraform plan&#x000A;</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code>+ example_server.my-server&#x000A;    address: "1.2.3.4"&#x000A;&#x000A;&#x000A;Plan: 1 to add, 0 to change, 0 to destroy.&#x000A;</code></pre>
<ol start="7">
<li>
<p>Terraform will ask for confirmation when you run <code>terraform apply</code>. Enter <strong>yes</strong> to create your example server and commit it to state:</p>
</li>
</ol>
<pre><code>terraform apply&#x000A;</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code>An execution plan has been generated and is shown below.&#x000A;Resource actions are indicated with the following symbols:&#x000A;  + create&#x000A;&#x000A;Terraform will perform the following actions:&#x000A;&#x000A;  + example_server.my-server&#x000A;      id:      &lt;computed&gt;&#x000A;      address: "1.2.3.4"&#x000A;&#x000A;&#x000A;Plan: 1 to add, 0 to change, 0 to destroy.&#x000A;&#x000A;Do you want to perform these actions?&#x000A;  Terraform will perform the actions described above.&#x000A;  Only 'yes' will be accepted to approve.&#x000A;&#x000A;  Enter a value: yes&#x000A;&#x000A;example_server.my-server: Creating...&#x000A;  address: "" =&gt; "1.2.3.4"&#x000A;example_server.my-server: Creation complete after 0s (ID: 1.2.3.4)&#x000A;</code></pre>
<ol start="8">
<li>
<p>Since the <code>Create</code> operation used <code>SetId</code>, Terraform believes the resource created successfully. Verify this by running <code>terraform plan</code>.</p>
</li>
</ol>
<pre><code>terraform plan&#x000A;</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code>Refreshing Terraform state in-memory prior to plan...&#x000A;The refreshed state will be used to calculate this plan, but will not be&#x000A;persisted to local or remote state storage.&#x000A;&#x000A;example_server.my-server: Refreshing state... (ID: 1.2.3.4)&#x000A;&#x000A;------------------------------------------------------------------------&#x000A;&#x000A;No changes. Infrastructure is up-to-date.&#x000A;&#x000A;This means that Terraform did not detect any differences between your&#x000A;configuration and real physical resources that exist. As a result, no&#x000A;actions need to be performed.&#x000A;</code></pre>
<p>Again, because of the call to <code>SetId</code>, Terraform believes the resource was created. When running <code>plan</code>, Terraform properly determines there are no changes to apply.</p>
<ol start="9">
<li>
<p>To verify this behavior, first change the value of the address field then run terraform plan again.</p>
</li>
</ol>
<pre><code>terraform plan&#x000A;</code></pre>
<p>You should see output like this:</p>
<p><strong>Example Output:</strong></p>
<pre><code>Refreshing Terraform state in-memory prior to plan...&#x000A;The refreshed state will be used to calculate this plan, but will not be&#x000A;persisted to local or remote state storage.&#x000A;&#x000A;example_server.my-server: Refreshing state... (ID: 1.2.3.4)&#x000A;&#x000A;------------------------------------------------------------------------&#x000A;&#x000A;An execution plan has been generated and is shown below.&#x000A;Resource actions are indicated with the following symbols:&#x000A;  ~ update in-place&#x000A;&#x000A;Terraform will perform the following actions:&#x000A;&#x000A;  ~ example_server.my-server&#x000A;      address: "1.2.3.4" =&gt; "5.6.7.8"&#x000A;&#x000A;&#x000A;Plan: 0 to add, 1 to change, 0 to destroy.&#x000A;&#x000A;------------------------------------------------------------------------&#x000A;&#x000A;Note: You didn't specify an "-out" parameter to save this plan, so Terraform&#x000A;can't guarantee that exactly these actions will be performed if&#x000A;"terraform apply" is subsequently run.&#x000A;</code></pre>
<p>Terraform detects the change and displays a diff with a ~ prefix, noting the resource will be modified in place, rather than created new.</p>
<ol start="10">
<li>
<p>Run <code>terraform apply</code> to apply the changes. Terraform will again prompt for confirmation. Type <code>yes</code>.</p>
</li>
</ol>
<pre><code>terraform apply&#x000A;</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code>example_server.my-server: Refreshing state... (ID: 1.2.3.4)&#x000A;&#x000A;An execution plan has been generated and is shown below.&#x000A;Resource actions are indicated with the following symbols:&#x000A;  ~ update in-place&#x000A;&#x000A;Terraform will perform the following actions:&#x000A;&#x000A;  ~ example_server.my-server&#x000A;      address: "1.2.3.4" =&gt; "5.6.7.8"&#x000A;&#x000A;&#x000A;Plan: 0 to add, 1 to change, 0 to destroy.&#x000A;&#x000A;Do you want to perform these actions?&#x000A;  Terraform will perform the actions described above.&#x000A;  Only 'yes' will be accepted to approve.&#x000A;&#x000A;  Enter a value: yes&#x000A;&#x000A;example_server.my-server: Modifying... (ID: 1.2.3.4)&#x000A;  address: "1.2.3.4" =&gt; "5.6.7.8"&#x000A;example_server.my-server: Modifications complete after 0s (ID: 1.2.3.4)&#x000A;&#x000A;Apply complete! Resources: 0 added, 1 changed, 0 destroyed.&#x000A;</code></pre>
<p>Since you didn't implement the Update function, you would expect the terraform plan operation to report changes, but it does not! How were your changes persisted without the Update implementation?</p>
<h2 id="step11">Error handling &amp; partial state</h2>
<p>Previously your Update operation succeeded and persisted the new state with an empty function definition. Recall the current update function:</p>
<pre><code>func resourceServerUpdate(d *schema.ResourceData, m interface{}) error {&#x000A;        return nil&#x000A;}&#x000A;</code></pre>
<p>The <code>return nil</code> tells Terraform that the update operation succeeded without error. Terraform assumes this means any changes requested applied without error. Because of this, our state updated and Terraform believes there are no further changes.</p>
<p>To say it another way: if a callback returns no error, Terraform automatically assumes the entire diff successfully applied, merges the diff into the final state, and persists it.</p>
<p>Functions should never intentionally <code>panic</code> or call <code>os.Exit</code> - always return an error.</p>
<p>In reality, it is a bit more complicated than this. Imagine the scenario where our update function has to update two separate fields which require two separate API calls. What do we do if the first API call succeeds but the second fails? How do we properly tell Terraform to only persist half the diff? This is known as a partial state scenario, and implementing these properly is critical to a well-behaving provider.</p>
<p>Here are the rules for state updating in Terraform.</p>
<ul>
<li>If the Create callback returns with or without an error without an ID set using <code>SetId</code>, the resource is assumed to not be created, and no state is saved.</li>
<li>If the Create callback returns with or without an error and an ID has been set, the resource is assumed created and all state is saved with it. Repeating because it is important: if there is an error, but the ID is set, the state is fully saved.</li>
<li>If the Update callback returns with or without an error, the full state is saved. If the ID becomes blank, the resource is destroyed (even within an update, though this shouldn't happen except in error scenarios).</li>
<li>If the Destroy callback returns without an error, the resource is assumed to be destroyed, and all state is removed.</li>
<li>If the Destroy callback returns with an error, the resource is assumed to still exist, and all prior state is preserved.</li>
<li>If partial mode (covered next) is enabled when a create or update returns, only the explicitly enabled configuration keys are persisted, resulting in a partial state.</li>
</ul>
<p>Here is an example of a partial mode with an update function:</p>
<pre><code>func resourceServerUpdate(d *schema.ResourceData, m interface{}) error {&#x000A;        // Enable partial state mode&#x000A;        d.Partial(true)&#x000A;&#x000A;        if d.HasChange("address") {&#x000A;                // Try updating the address&#x000A;                if err := updateAddress(d, m); err != nil {&#x000A;                        return err&#x000A;                }&#x000A;&#x000A;                d.SetPartial("address")&#x000A;        }&#x000A;&#x000A;        // If we were to return here, before disabling partial mode below,&#x000A;        // then only the "address" field would be saved.&#x000A;&#x000A;        // We succeeded, disable partial mode. This causes Terraform to save&#x000A;        // all fields again.&#x000A;        d.Partial(false)&#x000A;&#x000A;        return nil&#x000A;}&#x000A;</code></pre>
<p>Note - this code will not compile since there is no <code>updateAddress</code> function. You can implement a dummy version of this function to play around with partial state. For this example, partial state does not mean much. If <code>updateAddress</code> were to fail, then the address field would not be updated.</p>
<h2 id="step12">Implementing Destroy</h2>
<p>The Destroy callback is exactly what it sounds like - it is called to destroy the resource. This operation should never update any state on the resource. It is not necessary to call <code>d.SetId("")</code>, since any non-error return value assumes the resource was deleted successfully.</p>
<ol>
<li>
<p>Add the Destroy callback function:</p>
</li>
</ol>
<pre><code>func resourceServerDelete(d *schema.ResourceData, m interface{}) error {&#x000A;  // d.SetId("") is automatically called assuming delete returns no errors, but&#x000A;  // it is added here for explicitness.&#x000A;        d.SetId("")&#x000A;        return nil&#x000A;}&#x000A;</code></pre>
<p>The Destroy function should always handle the case where the resource might already be destroyed (manually, for example). If the resource is already destroyed, this should not return an error. This allows Terraform users to manually delete resources without breaking Terraform.</p>
<ol start="2">
<li>
<p>Recompile the Provider:</p>
</li>
</ol>
<pre><code>go build -o terraform-provider-example&#x000A;</code></pre>
<ol start="3">
<li>
<p>Place it in the proper plugins subdirectory with a new version numbers:</p>
</li>
</ol>
<pre><code>mkdir -p ~/.terraform.d/plugins/example.com/qwiklabs/example/1.0.2/linux_amd64&#x000A;cp terraform-provider-example ~/.terraform.d/plugins/example.com/qwiklabs/example/1.0.2/linux_amd64&#x000A;</code></pre>
<ol start="4">
<li>
<p>Update the <code>required_providers</code> block in <code>main.tf</code> to use new <strong>1.0.2</strong> version:</p>
</li>
</ol>
<pre><code># This is required for Terraform 0.13+&#x000A;terraform {&#x000A;  required_providers {&#x000A;    example = {&#x000A;      version = "~&gt; 1.0.2"&#x000A;      source  = "example.com/qwiklabs/example"&#x000A;    }&#x000A;  }&#x000A;}&#x000A;</code></pre>
<ol start="5">
<li>
<p>Reinitialize Terraform:</p>
</li>
</ol>
<pre><code>terraform init -upgrade&#x000A;</code></pre>
<ol start="6">
<li>
<p>Run <code>terraform destroy</code> to destroy the resource.</p>
</li>
</ol>
<pre><code>terraform destroy&#x000A;</code></pre>
<p><strong>Example Output:</strong></p>
<pre><code>example_server.my-server: Refreshing state... (ID: 5.6.7.8)&#x000A;&#x000A;An execution plan has been generated and is shown below.&#x000A;Resource actions are indicated with the following symbols:&#x000A;  - destroy&#x000A;&#x000A;Terraform will perform the following actions:&#x000A;&#x000A;  - example_server.my-server&#x000A;&#x000A;&#x000A;Plan: 0 to add, 0 to change, 1 to destroy.&#x000A;&#x000A;Do you really want to destroy?&#x000A;  Terraform will destroy all your managed infrastructure, as shown above.&#x000A;  There is no undo. Only 'yes' will be accepted to confirm.&#x000A;&#x000A;  Enter a value: yes&#x000A;&#x000A;example_server.my-server: Destroying... (ID: 5.6.7.8)&#x000A;example_server.my-server: Destruction complete after 0s&#x000A;&#x000A;Destroy complete! Resources: 1 destroyed.&#x000A;</code></pre>
<h2 id="step13">Implementing Read</h2>
<p>The Read callback is used to sync the local state with the actual state (upstream). This is called at various points by Terraform and should be a read-only operation. This callback should never modify the real resource.</p>
<p>If the ID is updated to blank, this tells Terraform the resource no longer exists (maybe it was destroyed out of band). Just like the destroy callback, the Read function should gracefully handle this case.</p>
<ol>
<li>
<p>Update the Read callback function:</p>
</li>
</ol>
<pre><code>func resourceServerRead(d *schema.ResourceData, m interface{}) error {&#x000A;  client := m.(*MyClient)&#x000A;&#x000A;  // Attempt to read from an upstream API&#x000A;  obj, ok := client.Get(d.Id())&#x000A;&#x000A;  // If the resource does not exist, inform Terraform. We want to immediately&#x000A;  // return here to prevent further processing.&#x000A;  if !ok {&#x000A;    d.SetId("")&#x000A;    return nil&#x000A;  }&#x000A;&#x000A;  d.Set("address", obj.Address)&#x000A;  return nil&#x000A;}&#x000A;</code></pre>
<h2 id="step14">Congratulations!</h2>
<p>In this lab, you built a custom provider for Terraform. You accomplished this by building a plugin, defining resources, learning about error handling and partial state, and implementing a few Terraform functions.</p>
<p><img alt="Terraform_badge_125.png" src="https://cdn.qwiklabs.com/vuwskBf1onEddtpZTLDYeMX3mdRbLdwSPzcjyY9icNM%3D"></p>
<h3>Finish Your Quest</h3>
<p>This self-paced lab is part of the <a href="https://google.qwiklabs.com/quests/44" target="_blank">Managing Cloud Infrastructure with Terraform</a> Quest. A Quest is a series of related labs that form a learning path. Completing this Quest earns you the badge above, to recognize your achievement. You can make your badge public and link to them in your online resume or social media account. <a href="https://google.qwiklabs.com/learning_paths/44/enroll" target="_blank">Enroll in this Quest</a> and get immediate completion credit if you've taken this lab.  <a href="https://google.qwiklabs.com/catalog" target="_blank">See other available Qwiklabs Quests</a>.</p>
<h3>Take Your Next Lab</h3>
<p>Continue your Quest with <a href="https://google.qwiklabs.com/catalog_lab/1018" target="_blank">Cloud SQL with Terraform</a>, or check out these suggestions:</p>
<ul>
<li>
<p><a href="https://google.qwiklabs.com/catalog_lab/1013" target="_blank">Using Vault on Compute Engine for Secret Management</a></p>
</li>
<li>
<p><a href="https://google.qwiklabs.com/catalog_lab/1012" target="_blank">Modular Load Balancing with Terraform - Regional Load Balancer</a></p>
</li>
</ul>
<h4>Next Steps / Learn More</h4>
<ul>
<li>Add Next Steps</li>
</ul>
<h3>Google Cloud Training &amp; Certification</h3>
<p>...helps you make the most of Google Cloud technologies. <a href="https://cloud.google.com/training/courses" target="_blank">Our classes</a> include technical skills and best practices to help you get up to speed quickly and continue your learning journey. We offer fundamental to advanced level training, with on-demand, live, and virtual options to suit your busy schedule. <a href="https://cloud.google.com/certification/" target="_blank">Certifications</a> help you validate and prove your skill and expertise in Google Cloud technologies.</p>

<h4>Manual Last Updated May 6, 2021</h4>
<h4>Lab Last Tested May 6, 2021</h4>
<p>Copyright 2021 Google LLC All rights reserved. Google and the Google logo are trademarks of Google LLC. All other company and product names may be trademarks of the respective companies with which they are associated.</p>



</div>
</div>


<div class='hidden js-end-lab-button-container lab-content__end-lab-button'>
<ql-lab-control-button class='js-end-lab-button' running></ql-lab-control-button>
</div>
<!-- / TODO: Move recommendations into the end lab modal -->
<div class='lab-content__renderable-instructions'>
<div class='lab-content__recommendation'>
<!-- # TODO: Change classes so that this doesn't stack vertically -->
<section class='upcoming-cards'>
<h2 class='ql-headline-4'>Continue questing</h2>
<div class='content-card-grid'>
<div class='card-content-wrapper js-content-card' data-id='1018' data-level='Advanced' data-name='Cloud SQL with Terraform' data-type='Lab'>
<a class="card card--content elevation-0 content-lab" href="/focuses/1215?parent=catalog"><div class='card__image'>
<div class='card__image__inner' style='background-image: url(https://cdn.qwiklabs.com/assets/fractal3-aaa9ba81223b511f2592cade38ffee5a74965dee87a9280e1ce3a7a96fdc91f1.jpg)'></div>
</div>
<div class='card__body'>
<div class='overline card--content__type'>
Lab
</div>
<h3 class='card--content__title'>
Cloud SQL with Terraform
</h3>
<div class='card--content__description body-1'>
<p>
In this hands-on lab you will learn to create Cloud SQL instances with Terraform, then set up the Cloud SQL Proxy, testing the connection with both MySQL and PostgreSQL clients.
</p>
</div>
</div>
<div class='card__footer'>
<div class='card__footer__left'>
<span>Advanced</span>
</div>
<div class='card__footer__right'>
<div class='rateit' data-rateit-readonly='true' data-rateit-value='4.5452'></div>
</div>
</div>
</a></div>

</div>
</section>

</div>

</div>
</ql-drawer-content>
<ql-drawer end id='outline-drawer' open slot='drawer' width='320'>
<div class='js-lab-content-outline lab-content__outline'>
<a href='#step1'>GSP208</a><a href='#step2'>Overview</a><a href='#step3'>Setup and Requirements</a><a href='#step4'>Requirement of Custom Providers</a><a href='#step5'>The provider schema</a><a href='#step6'>Building the Plugin</a><a href='#step7'>Defining Resources</a><a href='#step8'>Move the Provider to Plugins Directory</a><a href='#step9'>Invoking the Provider</a><a href='#step10'>Implement Create</a><a href='#step11'>Error handling & partial state</a><a href='#step12'>Implementing Destroy</a><a href='#step13'>Implementing Read</a><a href='#step14'>Congratulations!</a>
</div>
</ql-drawer>
</ql-drawer-container>
</ql-drawer-content>
</ql-drawer-container>
<div class='lab-introduction js-lab-introduction is-hidden'>
<div class='lab-introduction__inner'>
<h1 class='headline-1'>Welcome to Your First Lab!</h1>
<ql-icon-button class='js-skip-button'>close</ql-icon-button>
<div class='lab-introduction__video'>
<iframe allow='autoplay; encrypted-media' allowfullscreen frameborder='0' id='lab-introduction' src='https://www.youtube.com/embed/yF7EDXKTmoQ?enablejsapi=1&amp;rel=0&amp;showinfo=0'></iframe>
</div>
<a class='js-skip-button button button--outline'>Skip this video</a>
</div>
</div>



</div>
</main>


<div class='modal fade' id='lab-details-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<div class='modal-body'>
<p class='l-mbm'>
In Terraform, a Provider is the logical abstraction of an upstream API. This lab will show you how to build a custom provider for Terraform.
</p>
<p>
This lab is included in the quest
<a href="/quests/44">Managing Cloud Infrastructure with Terraform</a>.
If you complete this lab you&#39;ll receive credit for it when you enroll in this quest.
</p>
<p class='small-label l-mbs'>
<strong>
Duration:
</strong>
0m setup
&middot;
75m access
&middot;
75m completion
</p>
<p class='small-label l-mbs'>
<span><strong>Levels: </strong>expert</span>
</p>
<p class='small-label'>
<strong>
Permalink:
</strong>
<a href="https://www.qwiklabs.com/catalog_lab/1014">https://www.qwiklabs.com/catalog_lab/1014</a>
</p>
</div>
<div class='modal-actions'>
<a class='button button--text' data-dismiss='modal'>
Got It
</a>
</div>


</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='modal fade' id='lab-review-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<form class="simple_form js-lab-review-form" id="edit_lab_review_12409493" action="/lab_reviews/12409493" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="patch" /><div class='modal-body'>
<p class='label'>
How satisfied are you with this lab?*
</p>
<div class='rateit js-rateit' data-rateit-max='5' data-rateit-min='0' data-rateit-resetable='false' data-rateit-step='1' data-rateit-value='5'></div>
<div class='l-mtm'>

<div class="control-group hidden lab_review_user_id"><div class="controls"><input class="hidden" type="hidden" value="3894861" name="lab_review[user_id]" id="lab_review_user_id" /></div></div>
<div class="control-group hidden lab_review_classroom_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[classroom_id]" id="lab_review_classroom_id" /></div></div>
<div class="control-group hidden lab_review_lab_id"><div class="controls"><input class="hidden" type="hidden" value="1014" name="lab_review[lab_id]" id="lab_review_lab_id" /></div></div>
<div class="control-group hidden lab_review_focus_id"><div class="controls"><input class="hidden" type="hidden" name="lab_review[focus_id]" id="lab_review_focus_id" /></div></div>
<div class="control-group hidden lab_review_rating"><div class="controls"><input class="hidden js-rating-input" type="hidden" value="2" name="lab_review[rating]" id="lab_review_rating" /></div></div>
<div class="control-group text optional lab_review_comment"><label class="text optional control-label" for="lab_review_comment">Comment</label><div class="controls"><textarea class="text optional" name="lab_review[comment]" id="lab_review_comment">
</textarea></div></div>
</div>
</div>
<div class='modal-actions'>
<a class='button button--text' data-dismiss='modal'>
Cancel
</a>
<input type="submit" name="commit" value="Submit" disabled="disabled" id="submit" data-disabled="false" class="button" data-disable-with="Submit" />
</div>
</form>

</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>
<div class='modal fade' id='lab-access-modal'>
<div class='modal-container'>
<div class='mdl-shadow--24dp modal-content'>
<a class='lab-access-modal-close' data-analytics-action='dismissed_lab_payment_modal' data-dismiss='modal'>
<i class='material-icons'>close</i>
</a>
<form class="js-lab-access-form" action="/lab_onetime_coupons/activate?parent=catalog" accept-charset="UTF-8" data-remote="true" method="post"><input name="utf8" type="hidden" value="&#x2713;" />
<div class='modal-body'>
<div class='lab-access-modal'>
<input type="hidden" name="id" id="id" value="1204" />
<input type="hidden" name="user_id" id="user_id" value="3894861" />
<input type="hidden" name="launch_with_credits" id="launch_with_credits" value="0" class="js-launch-with-credits-input" />
<input type="hidden" name="launch_with_subs" id="launch_with_subs" value="0" class="js-launch-with-subscription-input" />
<input type="hidden" name="launch_with_access_code" id="launch_with_access_code" value="0" class="js-launch-with-access-code" />
<div class='lab-access-modal__method'>
<p>
This lab costs
9 Credits.
</p>
<p>
1896 Credits
available
</p>
<a class='button js-launch-with-credits-button js-lab-access-modal-button' data-analytics-action='clicked_launch_with_credits_button'>
Launch with
9 Credits
</a>
</div>
<div class='lab-access-modal__method'>
<p>
Enter Lab Access Code:
</p>
<div class='lab-access-modal__code js-access-code'>
<input type="text" name="uuid_1" id="uuid_1" value="" maxlength="4" placeholder="1234" class="js-access-code-input" />
<input type="text" name="uuid_2" id="uuid_2" value="" maxlength="4" placeholder="1234" class="js-access-code-input" />
<input type="text" name="uuid_3" id="uuid_3" value="" maxlength="4" placeholder="1234" class="js-access-code-input" />
<input type="text" name="uuid_4" id="uuid_4" value="" maxlength="4" placeholder="1234" class="js-access-code-input" />
</div>
<a class='button js-launch-with-access-code-button js-lab-access-modal-button' data-analytics-action='clicked_launch_with_access_code_button'>
Launch with Access Code
</a>
</div>
</div>
</div>
</form>



</div>
</div>
<iframe class='l-ie-iframe-fix'></iframe>
</div>


<script>
  $( function() {
    ql.initMaterialInputs();
    initChosen();
    initSearch();
    initTabs();
    ql.list.init();
    ql.favoriting.init();
    ql.header.myAccount.init();
    initTooltips();
    ql.autocomplete.init();
    ql.modals.init();
    ql.toggleButtons.init();
    ql.analytics.init();
    ql.favoriting.init();
  ql.labControlPanel.addRecaptchaErrorHandler();
  initLabContent();
  ql.labOutline.links.init();
  initLabReviewModal();
  initLabAccessModal();
  ql.labAssessment.init();
  ql.labIntroduction.init( true );
  ql.labData.init();
  initLabTranslations( {"are_you_sure":"All done? If you end this lab, you will lose all your work. You may not be able to restart the lab if there is a quota limit. Are you sure you want to end this lab?\n","in_progress":"*In Progress*","ending":"*Ending*","starting":"*Starting, please wait*","end_concurrent_labs":"Sorry, you can only run one lab at a time. To start this lab, please confirm that you want all of your existing labs to end.\n","copied":"Copied","no_resource":"Error retrieving resource.","no_support":"No Support","mac_press":"Press ⌘-C to copy","thanks_review":"Thanks for reviewing this lab.","windows_press":"Press Ctrl-C to copy","days":"days"} );
  ql.labRun.init();
  ql.initHeader();
  ql.navigation.init();
  ql.navPanel.init();
  ql.navigation.init();
  
  });
</script>

</body>
</html>

